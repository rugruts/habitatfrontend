var Fe=Object.defineProperty;var Te=(i,s,a)=>s in i?Fe(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a;var re=(i,s,a)=>Te(i,typeof s!="symbol"?s+"":s,a);import{aq as Ge,s as K,r as l,ar as le,as as Q,j as e,at as q,au as Y,av as $e,aw as Oe,ax as Le,ay as de,az as qe,aA as He,aB as Ue,aC as Ve,c as _,aD as We,u as Ke,R as me,aE as L,m as Ye,C as v,v as A,w as R,x as ee,i as k,aF as E,aj as xe,aG as se,aH as ze,aI as Je,aJ as Xe,aK as I,aL as Ze,aM as Qe,aN as es,aO as ss,B as P,ak as ne,a3 as as,K as ae,an as z,aP as B,z as J,y as X,aQ as ie,aR as U,aS as G,O,P as ue,aT as ts,aU as rs,aV as ns,aW as is,aX as os,aY as cs,aZ as ls,a_ as ds,a8 as ms,H as xs,a$ as us,b0 as ps,b1 as hs,t as gs,b2 as fs,S as oe,A as ce,b3 as ys,b4 as js,b5 as bs,b6 as Ns,b7 as vs,b8 as ks,b9 as ws,ba as Cs}from"./index-DqjjBafN.js";import{e as $,S as Ss,K as Ps}from"./EmailAutomationService-DHShxD-m.js";import{E as Z}from"./euro-BULGCHgN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=Ge("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);class As{constructor(){re(this,"API_BASE_URL","https://backendhabitatapi.vercel.app/api")}createBookingConfirmationEmail(s){const a=new Date(s.checkIn).toLocaleDateString("en-GB"),r=new Date(s.checkOut).toLocaleDateString("en-GB"),t=Math.ceil((new Date(s.checkOut).getTime()-new Date(s.checkIn).getTime())/(1e3*60*60*24)),n=`Booking Confirmed - ${s.propertyName} | Habitat Lobby`,d=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Booking Confirmation</title>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: #2D5A27; color: white; padding: 30px 20px; text-align: center; border-radius: 8px 8px 0 0; }
          .content { padding: 30px 20px; background: #ffffff; }
          .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
          .detail-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 5px 0; border-bottom: 1px solid #eee; }
          .detail-row:last-child { border-bottom: none; }
          .footer { background: #f8f9fa; padding: 20px; text-align: center; font-size: 14px; color: #666; border-radius: 0 0 8px 8px; }
          .button { background: #D4A574; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 20px 0; }
          .highlight { background: #e8f5e8; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #2D5A27; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>ðŸŽ‰ Booking Confirmed!</h1>
            <p>Thank you for choosing Habitat Lobby</p>
          </div>
          
          <div class="content">
            <p>Dear ${s.guestName},</p>
            
            <p>We're delighted to confirm your reservation. Your booking details are below:</p>
            
            <div class="booking-details">
              <h3 style="margin-top: 0; color: #2D5A27;">Booking Reference: ${s.bookingId}</h3>
              <div class="detail-row">
                <span><strong>Property:</strong></span>
                <span>${s.propertyName}</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-in:</strong></span>
                <span>${a} (15:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-out:</strong></span>
                <span>${r} (11:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Duration:</strong></span>
                <span>${t} night${t>1?"s":""}</span>
              </div>
              <div class="detail-row">
                <span><strong>Guests:</strong></span>
                <span>${s.guests}</span>
              </div>
              <div class="detail-row">
                <span><strong>Total Amount:</strong></span>
                <span><strong>â‚¬${s.totalAmount.toFixed(2)}</strong></span>
              </div>
            </div>
            
            ${s.specialRequests?`
            <div class="booking-details">
              <h4 style="margin-top: 0; color: #2D5A27;">Special Requests:</h4>
              <p style="margin-bottom: 0;">${s.specialRequests}</p>
            </div>
            `:""}
            
            <div class="highlight">
              <h3 style="margin-top: 0;">ðŸ“‹ What's Next?</h3>
              <ul style="margin-bottom: 0;">
                <li>You'll receive check-in instructions 48 hours before arrival</li>
                <li>Free cancellation up to 48 hours before check-in</li>
                <li>Our local team is available 24/7 for assistance</li>
                <li>Please bring the same ID document used during booking</li>
              </ul>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
              <a href="https://habitatlobby.com/view-booking/${s.bookingId}" class="button">
                View Booking Details
              </a>
            </div>
            
            <p>We look forward to hosting you in beautiful Trikala!</p>
            
            <p>Best regards,<br>
            <strong>The Habitat Lobby Team</strong></p>
          </div>
          
          <div class="footer">
            <p><strong>Habitat Lobby</strong> | Trikala, Greece</p>
            <p>For support, contact us at <a href="mailto:hello@habitatlobby.com">hello@habitatlobby.com</a></p>
            <p style="font-size: 12px; color: #999; margin-top: 15px;">
              This email was sent regarding your booking ${s.bookingId}. 
              Please keep this email for your records.
            </p>
          </div>
        </div>
      </body>
      </html>
    `,c=`
      Booking Confirmed - Habitat Lobby
      
      Dear ${s.guestName},
      
      We're delighted to confirm your reservation.
      
      Booking Reference: ${s.bookingId}
      Property: ${s.propertyName}
      Check-in: ${a} (15:00)
      Check-out: ${r} (11:00)
      Duration: ${t} night${t>1?"s":""}
      Guests: ${s.guests}
      Total Amount: â‚¬${s.totalAmount.toFixed(2)}
      
      ${s.specialRequests?`Special Requests: ${s.specialRequests}

`:""}
      
      What's Next?
      - You'll receive check-in instructions 48 hours before arrival
      - Free cancellation up to 48 hours before check-in
      - Our local team is available 24/7 for assistance
      - Please bring the same ID document used during booking
      
      View your booking: https://habitatlobby.com/view-booking/${s.bookingId}
      
      We look forward to hosting you in beautiful Trikala!
      
      Best regards,
      The Habitat Lobby Team
      
      Habitat Lobby | Trikala, Greece
      For support, contact us at hello@habitatlobby.com
    `;return{subject:n,html:d,text:c}}async sendBookingConfirmation(s){try{const a=this.createBookingConfirmationEmail(s);console.log("ðŸ“§ Sending booking confirmation email to:",s.guestEmail),console.log("ðŸ“§ Email subject:",a.subject);const r=await fetch(`${this.API_BASE_URL}/booking-confirmation`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"habitat_lobby_2024_86abfb60f093d26335ebc1f3b028f254"},body:JSON.stringify({bookingId:s.bookingId})});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(`Email API error: ${r.status} - ${n.error||"Unknown error"}`)}const t=await r.json();return console.log("âœ… Email sent successfully via API:",t),console.log("âœ… Booking confirmation email sent successfully"),!0}catch(a){return console.error("âŒ Failed to send booking confirmation email:",a),!1}}async sendBookingConfirmationById(s){var a;try{const r=await K.getAllBookings(1,0,{booking_id:s});if(!r.bookings||r.bookings.length===0)return console.error("Booking not found:",s),!1;const t=r.bookings[0],n={bookingId:t.id,guestName:t.customer_name,guestEmail:t.customer_email,propertyName:((a=t.properties)==null?void 0:a.name)||"Property",checkIn:t.check_in,checkOut:t.check_out,guests:t.guests,totalAmount:t.total_amount,currency:t.currency||"EUR",specialRequests:t.special_requests};return await this.sendBookingConfirmation(n)}catch(r){return console.error("Failed to send booking confirmation by ID:",r),!1}}}const V=new As,Rs=()=>{const i=l.useCallback(async t=>{try{const n={...t,booking_status:"confirmed"};await $.processAutomationTrigger(n),console.log("âœ… Booking confirmation email triggered")}catch(n){console.error("âŒ Error triggering booking confirmation email:",n)}},[]),s=l.useCallback(async t=>{try{const n={...t,booking_status:"confirmed"};await $.processAutomationTrigger(n),console.log("âœ… Pre-arrival email scheduled")}catch(n){console.error("âŒ Error scheduling pre-arrival email:",n)}},[]),a=l.useCallback(async t=>{try{const n={...t,booking_status:"completed"};await $.processAutomationTrigger(n),console.log("âœ… Post-checkout review email scheduled")}catch(n){console.error("âŒ Error scheduling post-checkout review email:",n)}},[]),r=l.useCallback(async(t,n)=>{try{await $.processAutomationTrigger(n),console.log(`âœ… Manual email triggered: ${t}`)}catch(d){console.error(`âŒ Error triggering manual email (${t}):`,d)}},[]);return{triggerBookingConfirmation:i,triggerPreArrivalEmail:s,triggerPostCheckoutReview:a,triggerManualEmail:r}};var te="Radio",[Is,pe]=le(te),[_s,Bs]=Is(te),he=l.forwardRef((i,s)=>{const{__scopeRadio:a,name:r,checked:t=!1,required:n,disabled:d,value:c="on",onCheck:x,form:f,...y}=i,[o,h]=l.useState(null),u=Q(s,j=>h(j)),g=l.useRef(!1),N=o?f||!!o.closest("form"):!0;return e.jsxs(_s,{scope:a,checked:t,disabled:d,children:[e.jsx(q.button,{type:"button",role:"radio","aria-checked":t,"data-state":je(t),"data-disabled":d?"":void 0,disabled:d,value:c,...y,ref:u,onClick:Y(i.onClick,j=>{t||x==null||x(),N&&(g.current=j.isPropagationStopped(),g.current||j.stopPropagation())})}),N&&e.jsx(ye,{control:o,bubbles:!g.current,name:r,value:c,checked:t,required:n,disabled:d,form:f,style:{transform:"translateX(-100%)"}})]})});he.displayName=te;var ge="RadioIndicator",fe=l.forwardRef((i,s)=>{const{__scopeRadio:a,forceMount:r,...t}=i,n=Bs(ge,a);return e.jsx($e,{present:r||n.checked,children:e.jsx(q.span,{"data-state":je(n.checked),"data-disabled":n.disabled?"":void 0,...t,ref:s})})});fe.displayName=ge;var Ds="RadioBubbleInput",ye=l.forwardRef(({__scopeRadio:i,control:s,checked:a,bubbles:r=!0,...t},n)=>{const d=l.useRef(null),c=Q(d,n),x=Oe(a),f=Le(s);return l.useEffect(()=>{const y=d.current;if(!y)return;const o=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(o,"checked").set;if(x!==a&&u){const g=new Event("click",{bubbles:r});u.call(y,a),y.dispatchEvent(g)}},[x,a,r]),e.jsx(q.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...t,tabIndex:-1,ref:c,style:{...t.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});ye.displayName=Ds;function je(i){return i?"checked":"unchecked"}var Ms=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],H="RadioGroup",[Fs,Zs]=le(H,[de,pe]),be=de(),Ne=pe(),[Ts,Gs]=Fs(H),ve=l.forwardRef((i,s)=>{const{__scopeRadioGroup:a,name:r,defaultValue:t,value:n,required:d=!1,disabled:c=!1,orientation:x,dir:f,loop:y=!0,onValueChange:o,...h}=i,u=be(a),g=qe(f),[N,j]=He({prop:n,defaultProp:t??null,onChange:o,caller:H});return e.jsx(Ts,{scope:a,name:r,required:d,disabled:c,value:N,onValueChange:j,children:e.jsx(Ue,{asChild:!0,...u,orientation:x,dir:g,loop:y,children:e.jsx(q.div,{role:"radiogroup","aria-required":d,"aria-orientation":x,"data-disabled":c?"":void 0,dir:g,...h,ref:s})})})});ve.displayName=H;var ke="RadioGroupItem",we=l.forwardRef((i,s)=>{const{__scopeRadioGroup:a,disabled:r,...t}=i,n=Gs(ke,a),d=n.disabled||r,c=be(a),x=Ne(a),f=l.useRef(null),y=Q(s,f),o=n.value===t.value,h=l.useRef(!1);return l.useEffect(()=>{const u=N=>{Ms.includes(N.key)&&(h.current=!0)},g=()=>h.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",g)}},[]),e.jsx(Ve,{asChild:!0,...c,focusable:!d,active:o,children:e.jsx(he,{disabled:d,required:n.required,checked:o,...x,...t,name:n.name,ref:y,onCheck:()=>n.onValueChange(t.value),onKeyDown:Y(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:Y(t.onFocus,()=>{var u;h.current&&((u=f.current)==null||u.click())})})})});we.displayName=ke;var $s="RadioGroupIndicator",Ce=l.forwardRef((i,s)=>{const{__scopeRadioGroup:a,...r}=i,t=Ne(a);return e.jsx(fe,{...t,...r,ref:s})});Ce.displayName=$s;var Se=ve,Pe=we,Os=Ce;const Ee=l.forwardRef(({className:i,...s},a)=>e.jsx(Se,{className:_("grid gap-2",i),...s,ref:a}));Ee.displayName=Se.displayName;const Ae=l.forwardRef(({className:i,...s},a)=>e.jsx(Pe,{ref:a,className:_("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...s,children:e.jsx(Os,{className:"flex items-center justify-center",children:e.jsx(We,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ae.displayName=Pe.displayName;const Ls=({selectedMethod:i,onMethodChange:s,amount:a,currency:r,className:t})=>{const{t:n}=Ke(),[d,c]=l.useState(!1),[x,f]=l.useState(!1);me.useEffect(()=>{window.ApplePaySession&&ApplePaySession.canMakePayments()&&c(!0),window.google&&window.google.payments&&f(!0)},[]);const y=[{id:"card",name:n("payment.creditCard"),description:n("payment.creditCardDesc"),icon:L,available:!0,badge:null},{id:"apple_pay",name:"Apple Pay",description:n("payment.applePayDesc"),icon:Es,available:d,badge:d?null:n("payment.notAvailable")},{id:"google_pay",name:"Google Pay",description:n("payment.googlePayDesc"),icon:Ss,available:x,badge:x?null:n("payment.notAvailable")},{id:"sepa",name:"SEPA Direct Debit",description:n("payment.sepaDesc"),icon:Ye,available:!0,badge:null},{id:"cash_on_arrival",name:n("payment.cashOnArrival"),description:n("payment.cashOnArrivalDesc"),icon:Z,available:!0,badge:n("payment.arrivalOnly")}];return e.jsxs(v,{className:t,children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-green-600"}),n("payment.selectMethod")]})}),e.jsxs(k,{children:[e.jsx(Ee,{value:i,onValueChange:o=>s(o),children:e.jsx("div",{className:"space-y-3",children:y.map(o=>{const h=o.icon;return e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{value:o.id,id:o.id,className:"peer sr-only",disabled:!o.available}),e.jsx(E,{htmlFor:o.id,className:`flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all duration-200 ${i===o.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"} ${o.available?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(h,{className:"h-6 w-6 text-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:o.name}),o.badge&&e.jsx(xe,{variant:"secondary",className:"text-xs",children:o.badge}),i===o.id&&e.jsx(se,{className:"h-4 w-4 text-green-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o.description})]})]})})]},o.id)})})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-800 mb-1",children:n("payment.securityTitle")}),e.jsx("p",{children:n("payment.securityDesc")})]})]})}),e.jsx("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[n("payment.totalAmount"),":"]}),e.jsx("span",{className:"text-xl font-bold text-primary",children:new Intl.NumberFormat("el-GR",{style:"currency",currency:r}).format(a/100)})]})})]})]})},qs=({amount:i,currency:s,bookingDetails:a,customerDetails:r,onSuccess:t,onError:n})=>{const d=Je(),c=Xe(),[x,f]=l.useState(!1),[y,o]=l.useState(""),[h,u]=l.useState("card");l.useState(!1);const g=async j=>{j.preventDefault(),f(!0),o("");try{if(h==="cash_on_arrival"){await N();return}if(!d||!c)throw new Error("Stripe not available");const{error:S,paymentIntent:w}=await d.confirmPayment({elements:c,confirmParams:{return_url:`${window.location.origin}/booking-confirmation`,payment_method_data:{billing_details:{name:(r==null?void 0:r.name)||"Guest",email:(r==null?void 0:r.email)||void 0}}},redirect:"if_required"});S?(o(S.message||"An unexpected error occurred."),n(S.message||"Payment failed")):w&&w.status==="succeeded"&&t(w)}catch(S){console.error("Payment error:",S),o("An unexpected error occurred during payment."),n("Payment failed")}finally{f(!1)}},N=async()=>{try{const j={id:`cash_${Date.now()}`,status:"succeeded",amount:i,metadata:{payment_method:"cash_on_arrival"}};t(j)}catch(j){console.error("Cash on arrival error:",j),o("Failed to process cash on arrival booking."),n("Cash on arrival booking failed")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{className:"border-0 shadow-lg bg-gray-50",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),"Booking Summary"]})}),e.jsxs(k,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Accommodation:"}),e.jsx("span",{className:"text-sm font-medium",children:a.unitName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-in:"}),e.jsx("span",{className:"text-sm font-medium",children:a.checkIn})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-out:"}),e.jsx("span",{className:"text-sm font-medium",children:a.checkOut})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Guests:"}),e.jsx("span",{className:"text-sm font-medium",children:a.guests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nights:"}),e.jsx("span",{className:"text-sm font-medium",children:a.nights})]}),e.jsx("div",{className:"border-t pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"font-bold text-lg",children:I(i,s)})]})})]})]}),e.jsx(Ls,{selectedMethod:h,onMethodChange:u,amount:i,currency:s}),e.jsxs(v,{className:"border-0 shadow-lg",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-accent"}),"Payment Details"]})}),e.jsxs(k,{children:[h==="cash_on_arrival"&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Cash on Arrival"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"You can pay in cash when you arrive at the property. No payment is required now."}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount to pay:"})," ",I(i,s)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment location:"})," At the property upon check-in"]})]})]})]})}),h!=="cash_on_arrival"&&e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Billing Address"}),e.jsx(Ze,{options:{mode:"billing",allowedCountries:["GR","US","GB","DE","FR","IT","ES"]}})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Payment Method"}),e.jsx(Qe,{options:{layout:"tabs",wallets:{applePay:"auto",googlePay:"auto"}}})]}),y&&e.jsx(es,{variant:"destructive",children:e.jsx(ss,{children:y})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-blue-50 p-3 rounded-lg",children:[e.jsx(ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Your payment information is secure and encrypted"})]}),e.jsx(P,{type:"submit",disabled:!d||x,className:"w-full h-12 text-lg font-semibold bg-accent hover:bg-accent/90",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 animate-spin"}),"Processing Payment..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Pay ",I(i,s)]})})]}),h==="cash_on_arrival"&&e.jsx(P,{onClick:g,disabled:x,className:"w-full h-12 text-lg font-semibold bg-green-600 hover:bg-green-700",children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 animate-spin"}),"Processing Booking..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Confirm Cash on Arrival Booking"]})})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"We accept multiple payment methods for your convenience"}),e.jsxs("div",{className:"flex justify-center gap-3 mt-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ’³"}),e.jsx("span",{className:"text-xs",children:"Cards"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸŽ"}),e.jsx("span",{className:"text-xs",children:"Apple Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸŸ¢"}),e.jsx("span",{className:"text-xs",children:"Google Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ…¿ï¸"}),e.jsx("span",{className:"text-xs",children:"PayPal"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ¦"}),e.jsx("span",{className:"text-xs",children:"Bank Transfer"})]})]}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Secure payments powered by Stripe"})]})]})},W=[{id:"details",label:"Guest Details",description:"Your information & ID verification"},{id:"payment",label:"Payment",description:"Secure checkout"},{id:"confirmation",label:"Confirmation",description:"Booking complete"}],Hs=({currentStep:i})=>{const s=W.findIndex(a=>a.id===i);return e.jsx("div",{className:"w-full py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:W.map((a,r)=>{const t=r<s,n=r===s,d=r>s;return e.jsxs(me.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:_("w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300",t&&"bg-green-600 text-white",n&&"bg-accent text-white ring-4 ring-accent/20",d&&"bg-gray-200 text-gray-500"),children:t?e.jsx(as,{className:"w-5 h-5"}):e.jsx("span",{children:r+1})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:_("text-sm font-medium",t&&"text-green-600",n&&"text-accent",d&&"text-gray-500"),children:a.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.description})]})]}),r<W.length-1&&e.jsx("div",{className:_("flex-1 h-0.5 mx-4 transition-all duration-300",r<s?"bg-green-600":"bg-gray-200")})]},a.id)})})})},Us=({unitName:i,checkIn:s,checkOut:a,guests:r,quote:t,className:n})=>{const d=new Date(s),c=new Date(a);return e.jsxs(v,{className:n,children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-accent"}),"Booking Summary"]})}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:i}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{children:[B(d,"EEE, MMM d")," - ",B(c,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.nights," nights"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("span",{children:[r," guest",r!==1?"s":""]})]})]})]}),e.jsx(ie,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Price Details"}),t.lineItems.map((x,f)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:x.label}),e.jsx("span",{className:"font-medium",children:I(x.amountCents,t.currency)})]},f)),e.jsx(ie,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-accent",children:I(t.totalCents,t.currency)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:["Free cancellation until ",t.refundableUntil?B(new Date(t.refundableUntil),"MMM d, h:mm a"):"48 hours before check-in"]})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm mb-1",children:"Check-in Information"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Check-in: 3:00 PM - 10:00 PM",e.jsx("br",{}),"Check-out: 11:00 AM",e.jsx("br",{}),"Self check-in with keypad"]})]})]})]})]})},Vs=[{code:"GR",name:"Greece"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"IT",name:"Italy"},{code:"ES",name:"Spain"},{code:"NL",name:"Netherlands"},{code:"BE",name:"Belgium"},{code:"AT",name:"Austria"},{code:"CH",name:"Switzerland"},{code:"SE",name:"Sweden"},{code:"NO",name:"Norway"},{code:"DK",name:"Denmark"},{code:"FI",name:"Finland"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"JP",name:"Japan"},{code:"OTHER",name:"Other"}],Ws=({form:i,errors:s,onChange:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(v,{children:[e.jsxs(A,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-accent"}),"Contact Information"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your contact details for booking confirmation and communication."})]}),e.jsxs(k,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"firstName",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"First Name *"]}),e.jsx(G,{id:"firstName",value:i.firstName,onChange:r=>a("firstName",r.target.value),className:s.firstName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your first name",required:!0}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"lastName",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Last Name *"]}),e.jsx(G,{id:"lastName",value:i.lastName,onChange:r=>a("lastName",r.target.value),className:s.lastName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your last name",required:!0}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Email Address *"]}),e.jsx(G,{id:"email",type:"email",value:i.email,onChange:r=>a("email",r.target.value),className:s.email?"border-red-500 focus:border-red-500":"",placeholder:"your.email@example.com",required:!0}),s.email&&e.jsx("p",{className:"text-sm text-red-600",children:s.email}),e.jsx("p",{className:"text-xs text-gray-500",children:"We'll send your booking confirmation and check-in instructions to this email."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Phone Number"]}),e.jsx(G,{id:"phone",type:"tel",value:i.phone,onChange:r=>a("phone",r.target.value),className:s.phone?"border-red-500 focus:border-red-500":"",placeholder:"+30 123 456 7890"}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We may contact you if needed regarding your stay."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"country",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Country of Residence"]}),e.jsxs(ts,{value:i.country,onValueChange:r=>a("country",r),children:[e.jsx(rs,{className:s.country?"border-red-500 focus:border-red-500":"",children:e.jsx(ns,{placeholder:"Select your country"})}),e.jsx(is,{children:Vs.map(r=>e.jsx(os,{value:r.code,children:r.name},r.code))})]}),s.country&&e.jsx("p",{className:"text-sm text-red-600",children:s.country})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"specialRequests",className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-4 w-4"}),"Special Requests"]}),e.jsx(ls,{id:"specialRequests",value:i.specialRequests,onChange:r=>a("specialRequests",r.target.value),placeholder:"Any special requests or requirements for your stay? (e.g., early check-in, late check-out, accessibility needs)",rows:3,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We'll do our best to accommodate your requests."})]})]})]}),e.jsx(v,{className:"bg-blue-50 border-blue-200",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Check-in Information"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Please bring a valid ID (passport or national ID card) for verification during check-in. The primary guest must be at least 18 years old."})]})]})})})]}),Ks=({bookingId:i,unitName:s,checkIn:a,checkOut:r,guests:t,customerName:n,customerEmail:d,totalAmount:c,currency:x,onBackToHome:f,onViewBooking:y,onDownloadConfirmation:o})=>{const h=new Date(a),u=new Date(r),g=Math.ceil((u.getTime()-h.getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(v,{className:"border-green-200 bg-green-50",children:e.jsxs(k,{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"w-8 h-8 text-white"})})}),e.jsx("h1",{className:"text-2xl font-bold text-green-800 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-green-700 mb-4",children:"Thank you for choosing Habitat Lobby. Your reservation has been successfully created."}),e.jsxs(xe,{variant:"secondary",className:"bg-green-100 text-green-800 px-4 py-2",children:["Booking ID: ",i.slice(-8).toUpperCase()]})]})}),e.jsxs(v,{children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-accent"}),"Booking Details"]})}),e.jsx(k,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:"Trikala, Greece"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs("span",{children:[B(h,"EEE, MMM d")," - ",B(u,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs("span",{children:[g," night",g!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("span",{children:[t," guest",t!==1?"s":""]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Guest Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:n})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:d})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-accent",children:I(c*100,x)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Payment confirmed"})]})]})]})})]}),e.jsxs(v,{children:[e.jsx(A,{children:e.jsx(R,{children:"What's Next?"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Confirmation Email Sent"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["A detailed confirmation has been sent to ",d]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Check-in Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed check-in instructions will be sent 24 hours before your arrival"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Ps,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Access Codes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Door codes and WiFi details will be provided 2 hours before check-in"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ds,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"24/7 Support"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Our team is available around the clock during your stay"})]})]})]})})]}),e.jsx(v,{className:"bg-gray-50",children:e.jsxs(k,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Need Help?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Contact Information"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx("span",{children:"hello@habitatlobby.com"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"+30 243 123 4567"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Check-in Details"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsx("p",{children:"Check-in: 3:00 PM - 10:00 PM"}),e.jsx("p",{children:"Check-out: 11:00 AM"}),e.jsx("p",{children:"Self check-in available"})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(P,{onClick:y,className:"flex-1",children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"View & Manage Booking"]}),e.jsxs(P,{onClick:f,variant:"outline",className:"flex-1",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Back to Home"]}),o&&e.jsxs(P,{onClick:o,variant:"outline",className:"flex-1",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Download Confirmation"]})]})]})},Qs=()=>{const i=ps(),{unitSlug:s,dates:a,guests:r,quote:t,reset:n}=hs(),{triggerBookingConfirmation:d}=Rs(),[c,x]=l.useState({firstName:"",lastName:"",email:"",phone:"",country:"",specialRequests:""}),[f,y]=l.useState(!1),[o,h]=l.useState(null),[u,g]=l.useState("details"),[N,j]=l.useState(""),[S,w]=l.useState({}),[D,M]=l.useState("");l.useEffect(()=>{console.log("ðŸ§ª CheckoutEnhanced: bookingEmailService loaded:",!!V),console.log("ðŸ§ª CheckoutEnhanced: bookingEmailService type:",typeof V),gs("checkout"),s&&fs(s)},[s]),l.useEffect(()=>{(async()=>{if(s){console.log("Fetching property name for unitSlug:",s);try{const b=vs.find(F=>F.slug===s);if(b){console.log("Found apartment by slug:",b.name),M(b.name);return}console.log("Not found in apartments data, fetching from Supabase...");const p=await K.getProperty(s);p?(console.log("Found property in Supabase:",p.name),M(p.name)):(console.log("Property not found, using fallback"),M(s))}catch(b){console.error("Error fetching property name:",b),M(s)}}})()},[s]);const Re=(m,b)=>{x(p=>({...p,[m]:b})),S[m]&&w(p=>({...p,[m]:""}))},Ie=l.useCallback(()=>{const m={};return c.firstName.trim()||(m.firstName="First name is required"),c.lastName.trim()||(m.lastName="Last name is required"),c.email.trim()?/\S+@\S+\.\S+/.test(c.email)||(m.email="Please enter a valid email address"):m.email="Email is required",w(m),Object.keys(m).length===0},[c]);if(!s||!t||!a.from||!a.to)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(oe,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsx("div",{className:"container py-10",children:e.jsx(v,{className:"max-w-md mx-auto",children:e.jsxs(k,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No booking in progress."}),e.jsxs(P,{onClick:()=>i(-1),variant:"outline",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Go Back"]})]})})})]});const _e=async m=>{m.preventDefault(),Ie()&&await Be()},Be=async()=>{y(!0),w({});try{console.log("Starting checkout process...");const m=await ks.startCheckout({unitSlug:s,checkIn:a.from,checkOut:a.to,guests:r,customer:c});if(console.log("Checkout response:",m),!m.clientSecret)throw new Error("No client secret received from payment service");j(m.clientSecret),g("payment")}catch(m){console.error("Failed to create payment intent:",m);const b=m instanceof Error?m.message:"Failed to prepare payment. Please try again.";w({payment:b})}finally{y(!1)}},De=async m=>{var b;try{console.log("Payment success! Payment intent:",m),console.log("Payment intent metadata:",m.metadata);let p=(b=m.metadata)==null?void 0:b.booking_id;if(!p){console.log("No booking_id in metadata, searching by payment_intent_id:",m.id);try{const{data:C,error:T}=await ws.from("bookings").select("id").eq("payment_intent_id",m.id).single();if(T)throw console.error("Error finding booking by payment_intent_id:",T),new Error("Could not find booking for this payment");p=C.id,console.log("Found booking by payment_intent_id:",p)}catch(C){throw console.error("Database error:",C),new Error("Could not find booking for this payment")}}if(!p)throw console.error("No booking_id found. Available metadata keys:",Object.keys(m.metadata||{})),new Error("No booking ID found in payment intent");if(p)try{await K.updateBookingStatus(p,"confirmed"),console.log("âœ… Booking confirmed:",p),console.log("ðŸ”„ Starting email notification process...");try{console.log("ðŸ”„ Attempting to send booking confirmation email for booking:",p),console.log("ðŸ“§ Calling bookingEmailService.sendBookingConfirmationById...");const C=await V.sendBookingConfirmationById(p);console.log("ðŸ“§ Email service result:",C),C?console.log("âœ… Booking confirmation email sent successfully!",{bookingId:p}):(console.error("âŒ Failed to send booking confirmation email"),console.log("ðŸ“§ Email will be retried later or sent manually"));try{console.log("ðŸ”„ Triggering email automation for booking confirmation..."),await d({booking_id:p,guest_email:c.email,guest_name:`${c.firstName} ${c.lastName}`.trim(),property_name:D,check_in:(a==null?void 0:a.checkIn)||"",check_out:(a==null?void 0:a.checkOut)||"",guest_count:r||1,total_amount:t!=null&&t.totalCents?t.totalCents/100:0,property_id:s||""}),console.log("âœ… Email automation triggered successfully")}catch(T){console.error("âŒ Error triggering email automation:",T)}}catch(C){console.error("ðŸ’¥ Email service error:",C),console.log("ðŸ“§ Email will be retried later or sent manually")}}catch(C){console.error("Failed to update booking status:",C)}const F=t!=null&&t.totalCents?t.totalCents/100:0;h({bookingId:p,customerName:`${c.firstName} ${c.lastName}`.trim(),customerEmail:c.email,totalAmount:F}),Cs(p,F),g("confirmation")}catch(p){console.error("Error processing payment success:",p),w({payment:"Payment succeeded but there was an error processing your booking. Please contact support."})}},Me=m=>{console.error("Payment failed:",m),w({payment:m||"Payment failed. Please try again."})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(oe,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsxs("div",{className:"container py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(Hs,{currentStep:u})})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"lg:col-span-2",children:[u==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ws,{form:c,errors:S,onChange:Re}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(P,{type:"button",variant:"outline",onClick:()=>i(-1),className:"flex-1",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(P,{type:"button",onClick:_e,className:"flex-1",size:"lg",children:"Continue to Add-ons"})]})]}),u==="payment"&&N&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ys,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Secure payment powered by Stripe"})]}),e.jsx(js,{stripe:bs,options:{clientSecret:N,appearance:Ns,locale:"en"},children:e.jsx(qs,{amount:t.totalCents,currency:t.currency,bookingDetails:{unitName:D||"Property",checkIn:a.from,checkOut:a.to,guests:r,nights:t.nights},customerDetails:{name:`${c.firstName} ${c.lastName}`.trim(),email:c.email},onSuccess:De,onError:Me})})]}),u==="confirmation"&&o&&e.jsx(Ks,{bookingId:o.bookingId,unitName:D||"Property",checkIn:a.from,checkOut:a.to,guests:r,customerName:o.customerName,customerEmail:o.customerEmail,totalAmount:o.totalAmount,currency:t.currency,onViewBooking:()=>{n(),i(`/view-booking/${o.bookingId}`)},onBackToHome:()=>{n(),i("/")}})]}),e.jsx("div",{className:"lg:col-span-1",children:u!=="confirmation"&&e.jsx(Us,{unitName:D||"Property",checkIn:a.from,checkOut:a.to,guests:r,quote:t,className:"sticky top-8"})})]})]})]})};export{Qs as default};
