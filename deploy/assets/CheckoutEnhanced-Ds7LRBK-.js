var Ke=Object.defineProperty;var Xe=(n,s,a)=>s in n?Ke(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var P=(n,s,a)=>Xe(n,typeof s!="symbol"?s+"":s,a);import{aq as Ze,s as ce,r as l,j as e,C as y,v as w,Y as le,w as k,i as j,ar as Ae,as as Ce,B as b,at as es,A as de,R as J,au as L,aj as K,av as B,aw as ae,m as ge,z as G,ax as pe,O as W,P as fe,ay as Ie,az as ye,aA as re,aB as me,aC as ss,aD as as,aE as ts,aF as Re,aG as rs,aH as ns,aI as is,aJ as os,c as Q,aK as cs,u as ls,x as je,aL as M,aM as ds,aN as D,ak as V,aO as ms,aP as hs,aQ as $,aR as xs,aS as us,a3 as gs,K as be,an as he,aT as z,y as xe,aU as _e,aV as ie,aW as se,aX as ps,aY as fs,aZ as ys,a_ as js,a$ as bs,b0 as Ns,b1 as vs,b2 as ws,a8 as ks,H as Ss,b3 as Es,b4 as _s,t as Ps,b5 as As,S as Pe,b6 as Cs,b7 as Is,b8 as Rs,b9 as Bs,ba as Ds,bb as Ts,bc as Ms}from"./index-ElYaiuRF.js";import{e as U,S as $s,K as Fs}from"./EmailAutomationService-DcMlbXrJ.js";import{E as X}from"./euro-DSA3GKe4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=Ze("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);class Ls{constructor(){P(this,"API_BASE_URL","https://backendhabitatapi.vercel.app/api")}createBookingConfirmationEmail(s){const a=new Date(s.checkIn).toLocaleDateString("en-GB"),t=new Date(s.checkOut).toLocaleDateString("en-GB"),r=Math.ceil((new Date(s.checkOut).getTime()-new Date(s.checkIn).getTime())/(1e3*60*60*24)),i=`Booking Confirmed - ${s.propertyName} | Habitat Lobby`,o=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Booking Confirmation</title>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: #2D5A27; color: white; padding: 30px 20px; text-align: center; border-radius: 8px 8px 0 0; }
          .content { padding: 30px 20px; background: #ffffff; }
          .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
          .detail-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 5px 0; border-bottom: 1px solid #eee; }
          .detail-row:last-child { border-bottom: none; }
          .footer { background: #f8f9fa; padding: 20px; text-align: center; font-size: 14px; color: #666; border-radius: 0 0 8px 8px; }
          .button { background: #D4A574; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 20px 0; }
          .highlight { background: #e8f5e8; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #2D5A27; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>üéâ Booking Confirmed!</h1>
            <p>Thank you for choosing Habitat Lobby</p>
          </div>
          
          <div class="content">
            <p>Dear ${s.guestName},</p>
            
            <p>We're delighted to confirm your reservation. Your booking details are below:</p>
            
            <div class="booking-details">
              <h3 style="margin-top: 0; color: #2D5A27;">Booking Reference: ${s.bookingId}</h3>
              <div class="detail-row">
                <span><strong>Property:</strong></span>
                <span>${s.propertyName}</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-in:</strong></span>
                <span>${a} (15:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-out:</strong></span>
                <span>${t} (11:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Duration:</strong></span>
                <span>${r} night${r>1?"s":""}</span>
              </div>
              <div class="detail-row">
                <span><strong>Guests:</strong></span>
                <span>${s.guests}</span>
              </div>
              <div class="detail-row">
                <span><strong>Total Amount:</strong></span>
                <span><strong>‚Ç¨${s.totalAmount.toFixed(2)}</strong></span>
              </div>
            </div>
            
            ${s.specialRequests?`
            <div class="booking-details">
              <h4 style="margin-top: 0; color: #2D5A27;">Special Requests:</h4>
              <p style="margin-bottom: 0;">${s.specialRequests}</p>
            </div>
            `:""}
            
            <div class="highlight">
              <h3 style="margin-top: 0;">üìã What's Next?</h3>
              <ul style="margin-bottom: 0;">
                <li>You'll receive check-in instructions 48 hours before arrival</li>
                <li>Free cancellation up to 48 hours before check-in</li>
                <li>Our local team is available 24/7 for assistance</li>
                <li>Please bring the same ID document used during booking</li>
              </ul>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
              <a href="https://habitatlobby.com/view-booking/${s.bookingId}" class="button">
                View Booking Details
              </a>
            </div>
            
            <p>We look forward to hosting you in beautiful Trikala!</p>
            
            <p>Best regards,<br>
            <strong>The Habitat Lobby Team</strong></p>
          </div>
          
          <div class="footer">
            <p><strong>Habitat Lobby</strong> | Trikala, Greece</p>
            <p>For support, contact us at <a href="mailto:hello@habitatlobby.com">hello@habitatlobby.com</a></p>
            <p style="font-size: 12px; color: #999; margin-top: 15px;">
              This email was sent regarding your booking ${s.bookingId}. 
              Please keep this email for your records.
            </p>
          </div>
        </div>
      </body>
      </html>
    `,m=`
      Booking Confirmed - Habitat Lobby
      
      Dear ${s.guestName},
      
      We're delighted to confirm your reservation.
      
      Booking Reference: ${s.bookingId}
      Property: ${s.propertyName}
      Check-in: ${a} (15:00)
      Check-out: ${t} (11:00)
      Duration: ${r} night${r>1?"s":""}
      Guests: ${s.guests}
      Total Amount: ‚Ç¨${s.totalAmount.toFixed(2)}
      
      ${s.specialRequests?`Special Requests: ${s.specialRequests}

`:""}
      
      What's Next?
      - You'll receive check-in instructions 48 hours before arrival
      - Free cancellation up to 48 hours before check-in
      - Our local team is available 24/7 for assistance
      - Please bring the same ID document used during booking
      
      View your booking: https://habitatlobby.com/view-booking/${s.bookingId}
      
      We look forward to hosting you in beautiful Trikala!
      
      Best regards,
      The Habitat Lobby Team
      
      Habitat Lobby | Trikala, Greece
      For support, contact us at hello@habitatlobby.com
    `;return{subject:i,html:o,text:m}}async sendBookingConfirmation(s){try{const a=this.createBookingConfirmationEmail(s);console.log("üìß Sending booking confirmation email to:",s.guestEmail),console.log("üìß Email subject:",a.subject);const t=await fetch(`${this.API_BASE_URL}/booking-confirmation`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"habitat_lobby_2024_86abfb60f093d26335ebc1f3b028f254"},body:JSON.stringify({bookingId:s.bookingId})});if(!t.ok){const i=await t.json().catch(()=>({}));throw new Error(`Email API error: ${t.status} - ${i.error||"Unknown error"}`)}const r=await t.json();return console.log("‚úÖ Email sent successfully via API:",r),console.log("‚úÖ Booking confirmation email sent successfully"),!0}catch(a){return console.error("‚ùå Failed to send booking confirmation email:",a),!1}}async sendBookingConfirmationById(s){var a;try{const t=await ce.getAllBookings(1,0,{booking_id:s});if(!t.bookings||t.bookings.length===0)return console.error("Booking not found:",s),!1;const r=t.bookings[0],i={bookingId:r.id,guestName:r.customer_name,guestEmail:r.customer_email,propertyName:((a=r.properties)==null?void 0:a.name)||"Property",checkIn:r.check_in,checkOut:r.check_out,guests:r.guests,totalAmount:r.total_amount,currency:r.currency||"EUR",specialRequests:r.special_requests};return await this.sendBookingConfirmation(i)}catch(t){return console.error("Failed to send booking confirmation by ID:",t),!1}}}const te=new Ls,Gs=()=>{const n=l.useCallback(async r=>{try{const i={...r,booking_status:"confirmed"};await U.processAutomationTrigger(i),console.log("‚úÖ Booking confirmation email triggered")}catch(i){console.error("‚ùå Error triggering booking confirmation email:",i)}},[]),s=l.useCallback(async r=>{try{const i={...r,booking_status:"confirmed"};await U.processAutomationTrigger(i),console.log("‚úÖ Pre-arrival email scheduled")}catch(i){console.error("‚ùå Error scheduling pre-arrival email:",i)}},[]),a=l.useCallback(async r=>{try{const i={...r,booking_status:"completed"};await U.processAutomationTrigger(i),console.log("‚úÖ Post-checkout review email scheduled")}catch(i){console.error("‚ùå Error scheduling post-checkout review email:",i)}},[]),t=l.useCallback(async(r,i)=>{try{await U.processAutomationTrigger(i),console.log(`‚úÖ Manual email triggered: ${r}`)}catch(o){console.error(`‚ùå Error triggering manual email (${r}):`,o)}},[]);return{triggerBookingConfirmation:n,triggerPreArrivalEmail:s,triggerPostCheckoutReview:a,triggerManualEmail:t}};class qs extends l.Component{constructor(){super(...arguments);P(this,"state",{hasError:!1,error:null,errorInfo:null});P(this,"logError",(a,t)=>{const r={error:{name:a.name,message:a.message,stack:a.stack},errorInfo:{componentStack:t.componentStack},timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href,context:"payment_processing"};console.error("üí≥ Payment Error Details:",r)});P(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onRetry&&this.props.onRetry()})}static getDerivedStateFromError(a){return{hasError:!0,error:a,errorInfo:null}}componentDidCatch(a,t){console.error("Payment Error Boundary caught an error:",a,t),this.logError(a,t),this.setState({error:a,errorInfo:t})}render(){var a;return this.state.hasError?e.jsxs(y,{className:"max-w-md mx-auto mt-8 border-red-200",children:[e.jsxs(w,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(le,{className:"w-6 h-6 text-red-600"})}),e.jsx(k,{className:"text-red-800",children:"Payment Error"})]}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs(Ae,{variant:"destructive",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(Ce,{children:"Something went wrong during payment processing. This might be a temporary issue."})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",((a=this.state.error)==null?void 0:a.message)||"Unknown error occurred"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",new Date().toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{onClick:this.handleRetry,className:"flex-1",variant:"outline",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),"Try Again"]}),this.props.onGoBack&&e.jsxs(b,{onClick:this.props.onGoBack,variant:"outline",className:"flex-1",children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Go Back"]})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center",children:"If this problem persists, please contact support with the error details above."})]})]}):this.props.children}}class Ys{constructor(){P(this,"MAX_RETRY_ATTEMPTS",3);P(this,"RETRY_DELAYS",[5*60*1e3,30*60*1e3,2*60*60*1e3])}async sendEmailWithFallback(s,a,t){const{recipientEmail:r,recipientName:i,bookingData:o}=t;console.log(`üìß Attempting to send ${a} email for booking ${s}`);try{if(a==="booking_confirmation"&&o)return console.log("üìß Trying email automation service..."),await U.processAutomationTrigger({booking_id:s,guest_email:r,guest_name:i||"Guest",property_name:o.propertyName||"Property",check_in:o.checkIn||"",check_out:o.checkOut||"",guest_count:o.guests||1,total_amount:o.totalAmount||0,booking_status:"confirmed",property_id:o.propertyId||""}),console.log("‚úÖ Email automation service succeeded"),{success:!0,method:"automation"}}catch(m){console.warn("‚ö†Ô∏è Email automation service failed:",m)}try{if(console.log("üìß Trying direct booking email service..."),await te.sendBookingConfirmationById(s))return console.log("‚úÖ Direct booking email service succeeded"),{success:!0,method:"direct"}}catch(m){console.warn("‚ö†Ô∏è Direct booking email service failed:",m)}return console.log("üìß All immediate methods failed, queuing for retry..."),await this.queueEmailForRetry(s,a,t),{success:!1,method:"queued_for_retry",error:"Email queued for retry due to service failures"}}async queueEmailForRetry(s,a,t){const r={id:`email_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,bookingId:s,emailType:a,recipientEmail:t.recipientEmail,recipientName:t.recipientName||"Guest",attempts:0,maxAttempts:this.MAX_RETRY_ATTEMPTS,status:"pending",lastAttemptAt:new Date().toISOString(),nextRetryAt:new Date(Date.now()+this.RETRY_DELAYS[0]).toISOString(),errors:[],metadata:t.bookingData},i=this.getEmailQueue();i.push(r),localStorage.setItem("email_retry_queue",JSON.stringify(i)),console.log("üìß Email queued for retry:",r.id)}async processRetryQueue(){const s=this.getEmailQueue(),a=new Date;for(const t of s)t.status==="pending"&&t.nextRetryAt&&new Date(t.nextRetryAt)<=a&&t.attempts<t.maxAttempts&&await this.retryEmail(t)}async retryEmail(s){console.log(`üìß Retrying email attempt ${s.attempts+1}/${s.maxAttempts} for ${s.id}`),s.attempts++,s.lastAttemptAt=new Date().toISOString();try{if(await te.sendBookingConfirmationById(s.bookingId))s.status="sent",console.log("‚úÖ Email retry succeeded:",s.id);else throw new Error("Booking email service returned false")}catch(a){const t=a instanceof Error?a.message:"Unknown error";if(s.errors.push(`Attempt ${s.attempts}: ${t}`),s.attempts>=s.maxAttempts)s.status="exhausted",console.error("‚ùå Email retry exhausted:",s.id),this.notifyAdminOfEmailFailure(s);else{const r=this.RETRY_DELAYS[s.attempts-1]||this.RETRY_DELAYS[this.RETRY_DELAYS.length-1];s.nextRetryAt=new Date(Date.now()+r).toISOString(),console.log(`üìß Email retry scheduled for ${s.nextRetryAt}:`,s.id)}}this.updateEmailInQueue(s)}getEmailQueue(){try{const s=localStorage.getItem("email_retry_queue");return s?JSON.parse(s):[]}catch(s){return console.error("Error reading email queue:",s),[]}}updateEmailInQueue(s){const a=this.getEmailQueue(),t=a.findIndex(r=>r.id===s.id);t!==-1&&(a[t]=s,localStorage.setItem("email_retry_queue",JSON.stringify(a)))}notifyAdminOfEmailFailure(s){console.error("üí• Email delivery failed after all retries:",{emailId:s.id,bookingId:s.bookingId,emailType:s.emailType,recipientEmail:s.recipientEmail,errors:s.errors})}getQueueStats(){const s=this.getEmailQueue();return{total:s.length,pending:s.filter(a=>a.status==="pending").length,sent:s.filter(a=>a.status==="sent").length,failed:s.filter(a=>a.status==="failed").length,exhausted:s.filter(a=>a.status==="exhausted").length}}cleanupQueue(s=7){const a=this.getEmailQueue(),t=new Date(Date.now()-s*24*60*60*1e3),r=a.filter(i=>i.status==="sent"||i.status==="exhausted"?new Date(i.lastAttemptAt)>t:!0);localStorage.setItem("email_retry_queue",JSON.stringify(r)),console.log(`üìß Cleaned up ${a.length-r.length} old email attempts`)}}const ue=new Ys;typeof window<"u"&&(setInterval(()=>{ue.processRetryQueue().catch(n=>{console.error("Error processing email retry queue:",n)})},5*60*1e3),setInterval(()=>{ue.cleanupQueue()},24*60*60*1e3));class Us{constructor(){P(this,"sessionId");P(this,"logs",[]);P(this,"MAX_LOGS",1e3);this.sessionId=this.generateSessionId(),this.initializeMonitoring()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}initializeMonitoring(){window.addEventListener("error",s=>{var a,t;this.logError("uncaught_error","Uncaught JavaScript error",{message:((a=s.error)==null?void 0:a.message)||s.message,filename:s.filename,lineno:s.lineno,colno:s.colno,stack:(t=s.error)==null?void 0:t.stack})}),window.addEventListener("unhandledrejection",s=>{var a;this.logError("unhandled_rejection","Unhandled promise rejection",{reason:s.reason,stack:(a=s.reason)==null?void 0:a.stack})}),document.addEventListener("visibilitychange",()=>{this.logInfo("page_visibility",`Page ${document.hidden?"hidden":"visible"}`)}),window.addEventListener("online",()=>{this.logInfo("network","Connection restored")}),window.addEventListener("offline",()=>{this.logWarn("network","Connection lost")})}logInfo(s,a,t){this.addLog("info",s,a,t)}logWarn(s,a,t){this.addLog("warn",s,a,t)}logError(s,a,t){this.addLog("error",s,a,t)}logDebug(s,a,t){this.addLog("debug",s,a,t)}addLog(s,a,t,r){const i={timestamp:new Date().toISOString(),level:s,category:a,message:t,data:r,sessionId:this.sessionId,userAgent:navigator.userAgent,url:window.location.href};this.logs.push(i),this.logs.length>this.MAX_LOGS&&(this.logs=this.logs.slice(-this.MAX_LOGS)),console[s==="error"?"error":s==="warn"?"warn":"log"](`[${s.toUpperCase()}] ${a}: ${t}`,r||""),s==="error"&&this.sendToExternalMonitoring(i)}trackPaymentEvent(s){this.logInfo("payment",`Payment ${s.eventType}`,s),this.updatePaymentMetrics(s)}trackBookingEvent(s){this.logInfo("booking",`Booking ${s.eventType}`,s),this.updateBookingMetrics(s)}trackEmailEvent(s){const a=s.eventType==="email_failed"?"error":"info";this.addLog(a,"email",`Email ${s.eventType}`,s)}trackPerformance(s,a,t){this.logInfo("performance",`${s} completed in ${a}ms`,{duration:a,...t}),a>5e3&&this.logWarn("performance",`Slow operation detected: ${s}`,{duration:a,...t})}trackUserAction(s,a){this.logInfo("user_action",s,a)}trackApiCall(s,a,t,r,i){const o=t>=400?"error":t>=300?"warn":"info";this.addLog(o,"api",`${a} ${s} - ${t}`,{endpoint:s,method:a,statusCode:t,duration:r,error:i})}getLogs(s,a){return this.logs.filter(t=>!(s&&t.category!==s||a&&t.level!==a))}getSystemInfo(){return{sessionId:this.sessionId,userAgent:navigator.userAgent,url:window.location.href,timestamp:new Date().toISOString(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,screen:{width:screen.width,height:screen.height,colorDepth:screen.colorDepth},viewport:{width:window.innerWidth,height:window.innerHeight},connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink,rtt:navigator.connection.rtt}:void 0}}exportLogs(){const s={systemInfo:this.getSystemInfo(),logs:this.logs,metrics:this.getMetrics()};return JSON.stringify(s,null,2)}updatePaymentMetrics(s){const a=this.getStoredMetrics();switch(a.payment||(a.payment={total_attempts:0,successful:0,failed:0,cancelled:0,by_method:{},errors:{}}),s.eventType){case"payment_started":a.payment.total_attempts++;break;case"payment_succeeded":a.payment.successful++,s.paymentMethod&&(a.payment.by_method[s.paymentMethod]=(a.payment.by_method[s.paymentMethod]||0)+1);break;case"payment_failed":a.payment.failed++,s.errorCode&&(a.payment.errors[s.errorCode]=(a.payment.errors[s.errorCode]||0)+1);break;case"payment_cancelled":a.payment.cancelled++;break}this.storeMetrics(a)}updateBookingMetrics(s){const a=this.getStoredMetrics();switch(a.booking||(a.booking={created:0,confirmed:0,cancelled:0,conversion_rate:0}),s.eventType){case"booking_created":a.booking.created++;break;case"booking_confirmed":a.booking.confirmed++;break;case"booking_cancelled":a.booking.cancelled++;break}a.booking.conversion_rate=a.booking.created>0?a.booking.confirmed/a.booking.created*100:0,this.storeMetrics(a)}getStoredMetrics(){try{const s=localStorage.getItem("app_metrics");return s?JSON.parse(s):{}}catch{return{}}}storeMetrics(s){try{localStorage.setItem("app_metrics",JSON.stringify(s))}catch(a){console.error("Failed to store metrics:",a)}}getMetrics(){return this.getStoredMetrics()}sendToExternalMonitoring(s){}}const H=new Us;typeof window<"u"&&(window.monitoring=H);const Hs=({sepaPayment:n,onCopyReference:s,onDownloadInstructions:a})=>{const[t,r]=J.useState(!1),[i,o]=J.useState(!1),m=async()=>{try{await navigator.clipboard.writeText(n.reference_code),r(!0),s==null||s(n.reference_code),setTimeout(()=>r(!1),2e3)}catch(d){console.error("Failed to copy reference code:",d)}},x=async()=>{try{await navigator.clipboard.writeText(n.iban_info.iban),o(!0),setTimeout(()=>o(!1),2e3)}catch(d){console.error("Failed to copy IBAN:",d)}},h=()=>{a==null||a(n)},u=new Date>new Date(n.expires_at);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600"}),e.jsx("h2",{className:"text-xl font-semibold",children:"SEPA Bank Transfer"})]}),e.jsx(K,{variant:u?"destructive":n.status==="confirmed"?"default":"secondary",className:"text-sm",children:u?"Expired":n.status.toUpperCase()})]}),u&&e.jsx(y,{className:"border-red-200 bg-red-50",children:e.jsxs(j,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Payment Expired"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"This payment has expired. Please contact us to arrange a new payment or extend the deadline."})]})}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),"Payment Amount"]})}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-3xl font-bold text-green-600",children:["‚Ç¨",n.amount.toFixed(2)]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Currency: ",n.currency]})]})]}),e.jsxs(y,{className:"border-2 border-blue-200 bg-blue-50",children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2 text-blue-800",children:[e.jsx(B,{className:"h-5 w-5"}),"Reference Code (IMPORTANT)"]})}),e.jsxs(j,{children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("code",{className:"text-lg font-mono font-bold text-blue-800",children:n.reference_code}),e.jsx(b,{variant:"outline",size:"sm",onClick:m,className:"ml-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Copy"]})})]})}),e.jsx("p",{className:"text-sm text-blue-700 mt-2 font-medium",children:"‚ö†Ô∏è You MUST include this reference code in your transfer description/message"})]})]}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-600"}),"Bank Account Details"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Account Holder"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded-lg",children:n.iban_info.account_holder})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Bank Name"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded-lg",children:n.iban_info.bank_name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"IBAN"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 p-3 bg-gray-50 rounded-lg font-mono",children:n.iban_info.iban}),e.jsx(b,{variant:"outline",size:"sm",onClick:x,children:i?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-1"}),"Copy"]})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"BIC/SWIFT Code"}),e.jsx("div",{className:"mt-1 p-3 bg-gray-50 rounded-lg font-mono",children:n.iban_info.bic})]})]})]}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Payment Instructions"})}),e.jsx(j,{children:e.jsx("div",{className:"prose prose-sm max-w-none",children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-gray-700",children:[e.jsx("li",{children:"Log into your online banking or visit your bank branch"}),e.jsx("li",{children:"Create a new SEPA transfer to our account"}),e.jsxs("li",{children:["Enter the amount: ",e.jsxs("strong",{children:["‚Ç¨",n.amount.toFixed(2)]})]}),e.jsxs("li",{children:["Use our IBAN: ",e.jsx("strong",{children:n.iban_info.iban})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"IMPORTANT:"})," Include the reference code ",e.jsx("code",{className:"bg-yellow-100 px-1 rounded",children:n.reference_code})," in the transfer description/message"]}),e.jsx("li",{children:"Complete the transfer"}),e.jsx("li",{children:"Your booking will be confirmed once we receive the payment"})]})})})]}),e.jsx(y,{children:e.jsxs(j,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:["Payment expires on: ",e.jsx("strong",{children:new Date(n.expires_at).toLocaleDateString()})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Please complete the transfer before this date to avoid cancellation"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{onClick:h,variant:"outline",className:"flex-1",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Download Instructions"]}),e.jsxs(b,{onClick:m,className:"flex-1",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Copy Reference Code"]})]}),e.jsx(y,{className:"bg-gray-50",children:e.jsxs(j,{className:"pt-6",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Need Help?"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ SEPA transfers usually take 1-3 business days"}),e.jsx("li",{children:"‚Ä¢ Keep your transfer receipt for reference"}),e.jsx("li",{children:"‚Ä¢ Contact us if you have any questions about the payment"}),e.jsx("li",{children:"‚Ä¢ Your booking is secure and will be confirmed upon payment receipt"})]})]})})]})},Ws=({sepaPayment:n,bookingId:s,onCopyReference:a,onDownloadInstructions:t,onBackToHome:r})=>{const[i,o]=J.useState(!1),m=async()=>{try{await navigator.clipboard.writeText(n.reference_code),o(!0),a==null||a(n.reference_code),setTimeout(()=>o(!1),2e3)}catch(h){console.error("Failed to copy reference code:",h)}},x=()=>{t==null||t(n)};return e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"SEPA Payment Instructions Sent!"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Your booking has been created and is pending payment confirmation."})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsxs(K,{variant:"secondary",children:["Booking ID: ",s]}),e.jsx(K,{variant:"outline",children:"Pending Payment"})]})]}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-5 w-5 text-blue-600"}),"Payment Summary"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx(X,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["‚Ç¨",n.amount.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Amount to Transfer"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx(G,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg font-semibold text-blue-600",children:new Date(n.expires_at).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Payment Deadline"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx(B,{className:"h-8 w-8 text-orange-600 mx-auto mb-2"}),e.jsx("div",{className:"text-lg font-semibold text-orange-600",children:n.reference_code}),e.jsx("div",{className:"text-sm text-gray-600",children:"Reference Code"})]})]})})]}),e.jsx(y,{className:"border-2 border-blue-200 bg-blue-50",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(B,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"‚Ä¢ Complete the bank transfer using the details below"}),e.jsx("li",{children:"‚Ä¢ Include the reference code in your transfer description"}),e.jsx("li",{children:"‚Ä¢ We'll confirm your booking once payment is received"}),e.jsx("li",{children:"‚Ä¢ You'll receive an email confirmation with all details"})]})]})]})})}),e.jsx(Hs,{sepaPayment:n,onCopyReference:a,onDownloadInstructions:t}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{onClick:m,className:"flex-1",variant:"outline",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),i?"Copied!":"Copy Reference Code"]}),e.jsxs(b,{onClick:x,className:"flex-1",variant:"outline",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Download Instructions"]}),e.jsx(b,{onClick:r,className:"flex-1",children:"Back to Home"})]}),e.jsxs(y,{className:"bg-gray-50",children:[e.jsx(w,{children:e.jsx(k,{className:"text-lg",children:"Need Help?"})}),e.jsxs(j,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Email Support"}),e.jsx("div",{className:"text-sm text-gray-600",children:"support@habitatlobby.com"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(fe,{className:"h-5 w-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Phone Support"}),e.jsx("div",{className:"text-sm text-gray-600",children:"+30 123 456 7890"})]})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-white rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsxs("strong",{children:["Reference your booking ID (",s,")"]})," when contacting support for faster assistance."]})})]})]})]})};var Ne="Radio",[Qs,Be]=Ie(Ne),[Vs,zs]=Qs(Ne),De=l.forwardRef((n,s)=>{const{__scopeRadio:a,name:t,checked:r=!1,required:i,disabled:o,value:m="on",onCheck:x,form:h,...u}=n,[d,g]=l.useState(null),p=ye(s,A=>g(A)),f=l.useRef(!1),N=d?h||!!d.closest("form"):!0;return e.jsxs(Vs,{scope:a,checked:r,disabled:o,children:[e.jsx(re.button,{type:"button",role:"radio","aria-checked":r,"data-state":Fe(r),"data-disabled":o?"":void 0,disabled:o,value:m,...u,ref:p,onClick:me(n.onClick,A=>{r||x==null||x(),N&&(f.current=A.isPropagationStopped(),f.current||A.stopPropagation())})}),N&&e.jsx($e,{control:d,bubbles:!f.current,name:t,value:m,checked:r,required:i,disabled:o,form:h,style:{transform:"translateX(-100%)"}})]})});De.displayName=Ne;var Te="RadioIndicator",Me=l.forwardRef((n,s)=>{const{__scopeRadio:a,forceMount:t,...r}=n,i=zs(Te,a);return e.jsx(ss,{present:t||i.checked,children:e.jsx(re.span,{"data-state":Fe(i.checked),"data-disabled":i.disabled?"":void 0,...r,ref:s})})});Me.displayName=Te;var Js="RadioBubbleInput",$e=l.forwardRef(({__scopeRadio:n,control:s,checked:a,bubbles:t=!0,...r},i)=>{const o=l.useRef(null),m=ye(o,i),x=as(a),h=ts(s);return l.useEffect(()=>{const u=o.current;if(!u)return;const d=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(d,"checked").set;if(x!==a&&p){const f=new Event("click",{bubbles:t});p.call(u,a),u.dispatchEvent(f)}},[x,a,t]),e.jsx(re.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...r,tabIndex:-1,ref:m,style:{...r.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});$e.displayName=Js;function Fe(n){return n?"checked":"unchecked"}var Ks=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ne="RadioGroup",[Xs,ya]=Ie(ne,[Re,Be]),Oe=Re(),Le=Be(),[Zs,ea]=Xs(ne),Ge=l.forwardRef((n,s)=>{const{__scopeRadioGroup:a,name:t,defaultValue:r,value:i,required:o=!1,disabled:m=!1,orientation:x,dir:h,loop:u=!0,onValueChange:d,...g}=n,p=Oe(a),f=rs(h),[N,A]=ns({prop:i,defaultProp:r??null,onChange:d,caller:ne});return e.jsx(Zs,{scope:a,name:t,required:o,disabled:m,value:N,onValueChange:A,children:e.jsx(is,{asChild:!0,...p,orientation:x,dir:f,loop:u,children:e.jsx(re.div,{role:"radiogroup","aria-required":o,"aria-orientation":x,"data-disabled":m?"":void 0,dir:f,...g,ref:s})})})});Ge.displayName=ne;var qe="RadioGroupItem",Ye=l.forwardRef((n,s)=>{const{__scopeRadioGroup:a,disabled:t,...r}=n,i=ea(qe,a),o=i.disabled||t,m=Oe(a),x=Le(a),h=l.useRef(null),u=ye(s,h),d=i.value===r.value,g=l.useRef(!1);return l.useEffect(()=>{const p=N=>{Ks.includes(N.key)&&(g.current=!0)},f=()=>g.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",f)}},[]),e.jsx(os,{asChild:!0,...m,focusable:!o,active:d,children:e.jsx(De,{disabled:o,required:i.required,checked:d,...x,...r,name:i.name,ref:u,onCheck:()=>i.onValueChange(r.value),onKeyDown:me(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:me(r.onFocus,()=>{var p;g.current&&((p=h.current)==null||p.click())})})})});Ye.displayName=qe;var sa="RadioGroupIndicator",Ue=l.forwardRef((n,s)=>{const{__scopeRadioGroup:a,...t}=n,r=Le(a);return e.jsx(Me,{...r,...t,ref:s})});Ue.displayName=sa;var He=Ge,We=Ye,aa=Ue;const Qe=l.forwardRef(({className:n,...s},a)=>e.jsx(He,{className:Q("grid gap-2",n),...s,ref:a}));Qe.displayName=He.displayName;const Ve=l.forwardRef(({className:n,...s},a)=>e.jsx(We,{ref:a,className:Q("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...s,children:e.jsx(aa,{className:"flex items-center justify-center",children:e.jsx(cs,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ve.displayName=We.displayName;const ta=({selectedMethod:n,onMethodChange:s,amount:a,currency:t,className:r})=>{const{t:i}=ls(),[o,m]=l.useState(!1),[x,h]=l.useState(!1);J.useEffect(()=>{window.ApplePaySession&&ApplePaySession.canMakePayments()&&m(!0),window.google&&window.google.payments&&h(!0)},[]);const u=[{id:"card",name:i("payment.creditCard"),description:i("payment.creditCardDesc"),icon:L,available:!0,badge:null},{id:"apple_pay",name:"Apple Pay",description:i("payment.applePayDesc"),icon:Os,available:o,badge:o?null:i("payment.notAvailable")},{id:"google_pay",name:"Google Pay",description:i("payment.googlePayDesc"),icon:$s,available:x,badge:x?null:i("payment.notAvailable")},{id:"sepa",name:"SEPA Bank Transfer",description:"Pay via bank transfer with IBAN. You will receive payment instructions and a reference code.",icon:ge,available:!0,badge:"Manual Confirmation"},{id:"cash_on_arrival",name:i("payment.cashOnArrival"),description:i("payment.cashOnArrivalDesc"),icon:X,available:!0,badge:i("payment.arrivalOnly")}];return e.jsxs(y,{className:r,children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-green-600"}),i("payment.selectMethod")]})}),e.jsxs(j,{children:[e.jsx(Qe,{value:n,onValueChange:d=>s(d),children:e.jsx("div",{className:"space-y-3",children:u.map(d=>{const g=d.icon;return e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{value:d.id,id:d.id,className:"peer sr-only",disabled:!d.available}),e.jsx(M,{htmlFor:d.id,className:`flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all duration-200 ${n===d.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"} ${d.available?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(g,{className:"h-6 w-6 text-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:d.name}),d.badge&&e.jsx(K,{variant:"secondary",className:"text-xs",children:d.badge}),n===d.id&&e.jsx(B,{className:"h-4 w-4 text-green-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d.description})]})]})})]},d.id)})})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ds,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-800 mb-1",children:i("payment.securityTitle")}),e.jsx("p",{children:i("payment.securityDesc")})]})]})}),e.jsx("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[i("payment.totalAmount"),":"]}),e.jsx("span",{className:"text-xl font-bold text-primary",children:new Intl.NumberFormat("el-GR",{style:"currency",currency:t}).format(a/100)})]})})]})]})};class ra{constructor(){P(this,"IBAN_INFO",{account_holder:"HABITAT LOBBY",iban:"GR1234567890123456789012345",bic:"PIRBGRAA",bank_name:"Piraeus Bank"});P(this,"PAYMENT_EXPIRY_DAYS",7)}generateReferenceCode(s){const a=Date.now().toString().slice(-6),t=Math.random().toString(36).substr(2,4).toUpperCase();return`SEPA-${a}-${t}`}async createSEPAPayment(s,a,t="EUR",r){try{const i=this.generateReferenceCode(s),o=new Date;o.setDate(o.getDate()+this.PAYMENT_EXPIRY_DAYS);const m={booking_id:s,reference_code:i,amount:a/100,currency:t,status:"pending",iban_info:this.IBAN_INFO,customer_info:r,payment_instructions:this.generatePaymentInstructions(i,a/100),expires_at:o.toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};try{const{data:x,error:h}=await D.from("sepa_payments").insert([m]).select().single();if(h)throw h;return x}catch(x){return console.warn("SEPA payments table not found, using fallback:",x),{id:`sepa_${Date.now()}`,...m}}}catch(i){throw console.error("Error creating SEPA payment:",i),new Error(`Failed to create SEPA payment: ${i instanceof Error?i.message:"Unknown error"}`)}}generatePaymentInstructions(s,a){return`
Please transfer ‚Ç¨${a.toFixed(2)} to our bank account using the following details:

Account Holder: ${this.IBAN_INFO.account_holder}
IBAN: ${this.IBAN_INFO.iban}
BIC/SWIFT: ${this.IBAN_INFO.bic}
Bank: ${this.IBAN_INFO.bank_name}

IMPORTANT: Please include the reference code "${s}" in your transfer description/message.

Your booking will be confirmed once we receive the payment in our account.
    `.trim()}async getSEPAPayment(s){try{const{data:a,error:t}=await D.from("sepa_payments").select("*").eq("booking_id",s).single();if(t){if(t.code==="PGRST116")return null;throw t}return a}catch(a){return console.error("Error fetching SEPA payment:",a),null}}async getSEPAPaymentByReference(s){try{const{data:a,error:t}=await D.from("sepa_payments").select("*").eq("reference_code",s).single();if(t){if(t.code==="PGRST116")return null;throw t}return a}catch(a){return console.error("Error fetching SEPA payment by reference:",a),null}}async confirmSEPAPayment(s,a){try{const{data:t,error:r}=await D.from("sepa_payments").update({status:"confirmed",confirmed_at:new Date().toISOString(),confirmed_by:a,updated_at:new Date().toISOString()}).eq("reference_code",s).select().single();if(r)throw r;return t}catch(t){throw console.error("Error confirming SEPA payment:",t),new Error(`Failed to confirm SEPA payment: ${t instanceof Error?t.message:"Unknown error"}`)}}async cancelSEPAPayment(s){try{const{data:a,error:t}=await D.from("sepa_payments").update({status:"cancelled",updated_at:new Date().toISOString()}).eq("reference_code",s).select().single();if(t)throw t;return a}catch(a){throw console.error("Error cancelling SEPA payment:",a),new Error(`Failed to cancel SEPA payment: ${a instanceof Error?a.message:"Unknown error"}`)}}isPaymentExpired(s){return new Date>new Date(s.expires_at)}async getPendingSEPAPayments(){try{const{data:s,error:a}=await D.from("sepa_payments").select("*").eq("status","pending").order("created_at",{ascending:!1});if(a)throw a;return s||[]}catch(s){return console.error("Error fetching pending SEPA payments:",s),[]}}async getPaymentStats(){try{const{data:s,error:a}=await D.from("sepa_payments").select("status");if(a)throw a;const t=s||[];return{total:t.length,pending:t.filter(r=>r.status==="pending").length,confirmed:t.filter(r=>r.status==="confirmed").length,cancelled:t.filter(r=>r.status==="cancelled").length,expired:t.filter(r=>r.status==="expired").length}}catch(s){return console.error("Error fetching SEPA payment stats:",s),{total:0,pending:0,confirmed:0,cancelled:0,expired:0}}}}const na=new ra,ia={idle:{icon:G,text:"Ready to process",color:"text-gray-500"},validating:{icon:V,text:"Validating payment details...",color:"text-blue-500"},processing:{icon:L,text:"Processing payment...",color:"text-blue-500"},confirming:{icon:V,text:"Confirming transaction...",color:"text-green-500"},completing:{icon:B,text:"Payment successful!",color:"text-green-500"}},oa=({stage:n,isVisible:s})=>{if(!s||n==="idle")return null;const a=ia[n],t=a.icon;return e.jsx("div",{className:"flex items-center justify-center p-4 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(t,{className:`h-5 w-5 ${a.color} ${n==="validating"||n==="confirming"?"animate-spin":""}`}),e.jsx("span",{className:`text-sm font-medium ${a.color}`,children:a.text})]})})},ca=({amount:n,currency:s,bookingId:a,bookingDetails:t,customerDetails:r,onSuccess:i,onError:o})=>{const m=ms(),x=hs(),[h,u]=l.useState(!1),[d,g]=l.useState("idle"),[p,f]=l.useState(""),[N,A]=l.useState("card");l.useState(!1);const[ve,q]=l.useState(null),[we,Z]=l.useState(!1),I=async S=>{S.preventDefault(),u(!0),g("validating"),f("");try{if(N==="cash_on_arrival"){g("processing"),await F();return}if(N==="sepa"){g("processing"),await O();return}if(!m||!x)throw new Error("Payment system not available. Please refresh and try again.");g("processing");const{error:C,paymentIntent:Y}=await m.confirmPayment({elements:x,confirmParams:{return_url:`${window.location.origin}/booking-confirmation`,payment_method_data:{billing_details:{name:(r==null?void 0:r.name)||"Guest",email:(r==null?void 0:r.email)||void 0}}},redirect:"if_required"});if(C){let T="Payment failed. Please try again.";C.type==="card_error"?T=C.message||"Your card was declined. Please check your details or try a different card.":C.type==="validation_error"?T="Please check your payment details and try again.":C.type==="api_error"&&(T="Payment system temporarily unavailable. Please try again in a moment."),f(T),o(T)}else Y&&Y.status==="succeeded"&&(g("confirming"),i(Y))}catch(C){console.error("Payment error:",C),f("An unexpected error occurred during payment."),o("Payment failed")}finally{u(!1),g("idle")}},F=async()=>{try{const S={id:`cash_${Date.now()}`,status:"succeeded",amount:n,metadata:{payment_method:"cash_on_arrival",booking_id:a}};i(S)}catch(S){console.error("Cash on arrival error:",S),f("Failed to process cash on arrival booking."),o("Cash on arrival booking failed")}},O=async()=>{try{if(console.log("Processing SEPA bank transfer booking..."),!a)throw new Error("Booking ID is required for SEPA payment");const S=await na.createSEPAPayment(a,n,s,{name:(r==null?void 0:r.name)||"Guest",email:(r==null?void 0:r.email)||""});console.log("SEPA payment created:",S),q(S),Z(!0);const C={id:`sepa_${Date.now()}`,status:"succeeded",amount:n,metadata:{payment_method:"sepa_bank_transfer",booking_id:a,sepa_reference:S.reference_code}};i(C)}catch(S){console.error("SEPA payment error:",S),f("Failed to process SEPA bank transfer booking."),o("SEPA bank transfer booking failed")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{className:"border-0 shadow-lg bg-gray-50",children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 text-green-600"}),"Booking Summary"]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Accommodation:"}),e.jsx("span",{className:"text-sm font-medium",children:t.unitName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-in:"}),e.jsx("span",{className:"text-sm font-medium",children:t.checkIn})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-out:"}),e.jsx("span",{className:"text-sm font-medium",children:t.checkOut})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Guests:"}),e.jsx("span",{className:"text-sm font-medium",children:t.guests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nights:"}),e.jsx("span",{className:"text-sm font-medium",children:t.nights})]}),e.jsx("div",{className:"border-t pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"font-bold text-lg",children:$(n,s)})]})})]})]}),e.jsx(ta,{selectedMethod:N,onMethodChange:A,amount:n,currency:s}),e.jsxs(y,{className:"border-0 shadow-lg",children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-accent"}),"Payment Details"]})}),e.jsxs(j,{children:[N==="cash_on_arrival"&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Cash on Arrival"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"You can pay in cash when you arrive at the property. No payment is required now."}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount to pay:"})," ",$(n,s)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment location:"})," At the property upon check-in"]})]})]})]})}),N==="sepa"&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Building2,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-green-900 mb-2",children:"SEPA Bank Transfer"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"Pay via bank transfer using our IBAN. You will receive detailed payment instructions and a unique reference code."}),e.jsxs("div",{className:"text-sm text-green-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount to pay:"})," ",$(n,s)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Processing time:"})," 1-3 business days"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Booking status:"})," Pending until payment received"]})]})]})]})}),N!=="cash_on_arrival"&&e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Billing Address"}),e.jsx(xs,{options:{mode:"billing",allowedCountries:["GR","US","GB","DE","FR","IT","ES"]}})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Payment Method"}),e.jsx(us,{options:{layout:"tabs",wallets:{applePay:"auto",googlePay:"auto"}}})]}),e.jsx(oa,{stage:d,isVisible:h}),p&&e.jsx(Ae,{variant:"destructive",children:e.jsx(Ce,{children:p})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-blue-50 p-3 rounded-lg",children:[e.jsx(je,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Your payment information is secure and encrypted"})]}),e.jsx(b,{type:"submit",disabled:!m||h,className:"w-full h-12 text-lg font-semibold bg-accent hover:bg-accent/90",children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 animate-spin"}),"Processing Payment..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Pay ",$(n,s)]})})]}),N==="cash_on_arrival"&&e.jsx(b,{onClick:I,disabled:h,className:"w-full h-12 text-lg font-semibold bg-green-600 hover:bg-green-700",children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 animate-spin"}),"Processing Booking..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Confirm Cash on Arrival Booking"]})}),N==="sepa"&&e.jsx(b,{onClick:I,disabled:h,className:"w-full h-12 text-lg font-semibold bg-blue-600 hover:bg-blue-700",children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 animate-spin"}),"Processing SEPA Booking..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Building2,{className:"h-5 w-5"}),"Confirm SEPA Bank Transfer Booking"]})})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"We accept multiple payment methods for your convenience"}),e.jsxs("div",{className:"flex justify-center gap-3 mt-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"üí≥"}),e.jsx("span",{className:"text-xs",children:"Cards"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"üçé"}),e.jsx("span",{className:"text-xs",children:"Apple Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"üü¢"}),e.jsx("span",{className:"text-xs",children:"Google Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"üÖøÔ∏è"}),e.jsx("span",{className:"text-xs",children:"PayPal"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"üè¶"}),e.jsx("span",{className:"text-xs",children:"Bank Transfer"})]})]}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Secure payments powered by Stripe"})]})]})},oe=[{id:"details",label:"Guest Details",description:"Your information & ID verification"},{id:"payment",label:"Payment",description:"Secure checkout"},{id:"confirmation",label:"Confirmation",description:"Booking complete"}],la=({currentStep:n})=>{const s=oe.findIndex(a=>a.id===n);return e.jsx("div",{className:"w-full py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:oe.map((a,t)=>{const r=t<s,i=t===s,o=t>s;return e.jsxs(J.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:Q("w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300",r&&"bg-green-600 text-white",i&&"bg-accent text-white ring-4 ring-accent/20",o&&"bg-gray-200 text-gray-500"),children:r?e.jsx(gs,{className:"w-5 h-5"}):e.jsx("span",{children:t+1})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:Q("text-sm font-medium",r&&"text-green-600",i&&"text-accent",o&&"text-gray-500"),children:a.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.description})]})]}),t<oe.length-1&&e.jsx("div",{className:Q("flex-1 h-0.5 mx-4 transition-all duration-300",t<s?"bg-green-600":"bg-gray-200")})]},a.id)})})})},da=({unitName:n,checkIn:s,checkOut:a,guests:t,quote:r,className:i})=>{const o=new Date(s),m=new Date(a);return e.jsxs(y,{className:i,children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-accent"}),"Booking Summary"]})}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:n}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("span",{children:[z(o,"EEE, MMM d")," - ",z(m,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:[r.nights," nights"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsxs("span",{children:[t," guest",t!==1?"s":""]})]})]})]}),e.jsx(_e,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Price Details"}),r.lineItems.map((x,h)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:x.label}),e.jsx("span",{className:"font-medium",children:$(x.amountCents,r.currency)})]},h)),e.jsx(_e,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-accent",children:$(r.totalCents,r.currency)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsxs("span",{children:["Free cancellation until ",r.refundableUntil?z(new Date(r.refundableUntil),"MMM d, h:mm a"):"48 hours before check-in"]})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm mb-1",children:"Check-in Information"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Check-in: 3:00 PM - 10:00 PM",e.jsx("br",{}),"Check-out: 11:00 AM",e.jsx("br",{}),"Self check-in with keypad"]})]})]})]})]})},ma=[{code:"GR",name:"Greece"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"IT",name:"Italy"},{code:"ES",name:"Spain"},{code:"NL",name:"Netherlands"},{code:"BE",name:"Belgium"},{code:"AT",name:"Austria"},{code:"CH",name:"Switzerland"},{code:"SE",name:"Sweden"},{code:"NO",name:"Norway"},{code:"DK",name:"Denmark"},{code:"FI",name:"Finland"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"JP",name:"Japan"},{code:"OTHER",name:"Other"}],ha=({form:n,errors:s,onChange:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-accent"}),"Contact Information"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your contact details for booking confirmation and communication."})]}),e.jsxs(j,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"firstName",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"First Name *"]}),e.jsx(se,{id:"firstName",value:n.firstName,onChange:t=>a("firstName",t.target.value),className:s.firstName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your first name",required:!0}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"lastName",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Last Name *"]}),e.jsx(se,{id:"lastName",value:n.lastName,onChange:t=>a("lastName",t.target.value),className:s.lastName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your last name",required:!0}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Email Address *"]}),e.jsx(se,{id:"email",type:"email",value:n.email,onChange:t=>a("email",t.target.value),className:s.email?"border-red-500 focus:border-red-500":"",placeholder:"your.email@example.com",required:!0}),s.email&&e.jsx("p",{className:"text-sm text-red-600",children:s.email}),e.jsx("p",{className:"text-xs text-gray-500",children:"We'll send your booking confirmation and check-in instructions to this email."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Phone Number"]}),e.jsx(se,{id:"phone",type:"tel",value:n.phone,onChange:t=>a("phone",t.target.value),className:s.phone?"border-red-500 focus:border-red-500":"",placeholder:"+30 123 456 7890"}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We may contact you if needed regarding your stay."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"country",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Country of Residence"]}),e.jsxs(ps,{value:n.country,onValueChange:t=>a("country",t),children:[e.jsx(fs,{className:s.country?"border-red-500 focus:border-red-500":"",children:e.jsx(ys,{placeholder:"Select your country"})}),e.jsx(js,{children:ma.map(t=>e.jsx(bs,{value:t.code,children:t.name},t.code))})]}),s.country&&e.jsx("p",{className:"text-sm text-red-600",children:s.country})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"specialRequests",className:"flex items-center gap-2",children:[e.jsx(Ns,{className:"h-4 w-4"}),"Special Requests"]}),e.jsx(vs,{id:"specialRequests",value:n.specialRequests,onChange:t=>a("specialRequests",t.target.value),placeholder:"Any special requests or requirements for your stay? (e.g., early check-in, late check-out, accessibility needs)",rows:3,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We'll do our best to accommodate your requests."})]})]})]}),e.jsx(y,{className:"bg-blue-50 border-blue-200",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Check-in Information"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Please bring a valid ID (passport or national ID card) for verification during check-in. The primary guest must be at least 18 years old."})]})]})})})]}),xa=({bookingId:n,unitName:s,checkIn:a,checkOut:t,guests:r,customerName:i,customerEmail:o,totalAmount:m,currency:x,onBackToHome:h,onViewBooking:u,onDownloadConfirmation:d})=>{const g=new Date(a),p=new Date(t),f=Math.ceil((p.getTime()-g.getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:"border-green-200 bg-green-50",children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 text-white"})})}),e.jsx("h1",{className:"text-2xl font-bold text-green-800 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-green-700 mb-4",children:"Thank you for choosing Habitat Lobby. Your reservation has been successfully created."}),e.jsxs(K,{variant:"secondary",className:"bg-green-100 text-green-800 px-4 py-2",children:["Booking ID: ",n.slice(-8).toUpperCase()]})]})}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-accent"}),"Booking Details"]})}),e.jsx(j,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Trikala, Greece"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("span",{children:[z(g,"EEE, MMM d")," - ",z(p,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsxs("span",{children:[f," night",f!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsxs("span",{children:[r," guest",r!==1?"s":""]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Guest Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{children:i})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:o})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-accent",children:$(m*100,x)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Payment confirmed"})]})]})]})})]}),e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"What's Next?"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(W,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Confirmation Email Sent"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["A detailed confirmation has been sent to ",o]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(G,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Check-in Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed check-in instructions will be sent 24 hours before your arrival"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Fs,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Access Codes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Door codes and WiFi details will be provided 2 hours before check-in"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(ws,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"24/7 Support"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Our team is available around the clock during your stay"})]})]})]})})]}),e.jsx(y,{className:"bg-gray-50",children:e.jsxs(j,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Need Help?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Contact Information"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"hello@habitatlobby.com"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"+30 243 123 4567"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Check-in Details"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsx("p",{children:"Check-in: 3:00 PM - 10:00 PM"}),e.jsx("p",{children:"Check-out: 11:00 AM"}),e.jsx("p",{children:"Self check-in available"})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(b,{onClick:u,className:"flex-1",children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"View & Manage Booking"]}),e.jsxs(b,{onClick:h,variant:"outline",className:"flex-1",children:[e.jsx(Ss,{className:"h-4 w-4 mr-2"}),"Back to Home"]}),d&&e.jsxs(b,{onClick:d,variant:"outline",className:"flex-1",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Download Confirmation"]})]})]})},ja=()=>{const n=Es(),{unitSlug:s,dates:a,guests:t,quote:r,reset:i}=_s();Gs();const[o,m]=l.useState({firstName:"",lastName:"",email:"",phone:"",country:"",specialRequests:""}),[x,h]=l.useState(!1),[u,d]=l.useState(null),[g,p]=l.useState("details"),[f,N]=l.useState(""),[A,ve]=l.useState(""),[q,we]=l.useState(null),[Z,I]=l.useState({}),[F,O]=l.useState("");l.useEffect(()=>{console.log("üß™ CheckoutEnhanced: bookingEmailService loaded:",!!te),console.log("üß™ CheckoutEnhanced: bookingEmailService type:",typeof te),Ps("checkout"),s&&As(s)},[s]),l.useEffect(()=>{(async()=>{if(s){console.log("Fetching property name for unitSlug:",s);try{const _=Ds.find(ee=>ee.slug===s);if(_){console.log("Found apartment by slug:",_.name),O(_.name);return}console.log("Not found in apartments data, fetching from Supabase...");const R=await ce.getProperty(s);R?(console.log("Found property in Supabase:",R.name),O(R.name)):(console.log("Property not found, using fallback"),O(s))}catch(_){console.error("Error fetching property name:",_),O(s)}}})()},[s]);const S=(c,_)=>{m(R=>({...R,[c]:_})),Z[c]&&I(R=>({...R,[c]:""}))},C=l.useCallback(()=>{const c={};return o.firstName.trim()||(c.firstName="First name is required"),o.lastName.trim()||(c.lastName="Last name is required"),o.email.trim()?/\S+@\S+\.\S+/.test(o.email)||(c.email="Please enter a valid email address"):c.email="Email is required",o.phone.trim()||(c.phone="Phone number is required"),o.country.trim()||(c.country="Country of residence is required"),I(c),Object.keys(c).length===0},[o]);if(!s||!r||!a.from||!a.to)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Pe,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsx("div",{className:"container py-10",children:e.jsx(y,{className:"max-w-md mx-auto",children:e.jsxs(j,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No booking in progress."}),e.jsxs(b,{onClick:()=>n(-1),variant:"outline",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Go Back"]})]})})})]});const Y=async c=>{c.preventDefault(),C()&&await T()},T=async()=>{h(!0),I({});try{console.log("Starting checkout process...");const c=await Ts.startCheckout({unitSlug:s,checkIn:a.from,checkOut:a.to,guests:t,customer:o});if(console.log("Checkout response:",c),!c.clientSecret)throw new Error("No client secret received from payment service");N(c.clientSecret),ve(c.bookingId),p("payment")}catch(c){console.error("Failed to create payment intent:",c);const _=c instanceof Error?c.message:"Failed to prepare payment. Please try again.";I({payment:_})}finally{h(!1)}},ze=async c=>{var _,R,ee,ke;try{console.log("Payment success! Payment intent:",c),console.log("Payment intent metadata:",c.metadata),H.trackPaymentEvent({eventType:"payment_succeeded",paymentIntentId:c.id,bookingId:(_=c.metadata)==null?void 0:_.booking_id,timestamp:new Date().toISOString()});let v=(R=c.metadata)==null?void 0:R.booking_id;if(((ee=c.metadata)==null?void 0:ee.payment_method)==="sepa_bank_transfer"){console.log("SEPA payment confirmed, showing instructions..."),we({reference_code:(ke=c.metadata)==null?void 0:ke.sepa_reference,amount:c.amount/100,currency:"EUR",status:"pending",expires_at:new Date(Date.now()+7*24*60*60*1e3).toISOString(),iban_info:{account_holder:"HABITAT LOBBY",iban:"GR1234567890123456789012345",bic:"PIRBGRAA",bank_name:"Piraeus Bank"},customer_info:{name:o.firstName+" "+o.lastName,email:o.email}}),p("confirmation");return}if(!v){console.log("No booking_id in metadata, searching by payment_intent_id:",c.id);try{const{data:E,error:Ee}=await D.from("bookings").select("id").eq("payment_intent_id",c.id).single();if(Ee)throw console.error("Error finding booking by payment_intent_id:",Ee),new Error("Could not find booking for this payment");v=E.id,console.log("Found booking by payment_intent_id:",v)}catch(E){throw console.error("Database error:",E),new Error("Could not find booking for this payment")}}if(!v)throw console.error("No booking_id found. Available metadata keys:",Object.keys(c.metadata||{})),new Error("No booking ID found in payment intent");if(v)try{await ce.updateBookingStatus(v,"confirmed"),console.log("‚úÖ Booking confirmed:",v),console.log("üîÑ Starting email notification process...");try{console.log("üîÑ Attempting to send booking confirmation email for booking:",v),H.trackEmailEvent({eventType:"email_queued",emailType:"booking_confirmation",bookingId:v,recipientEmail:o.email,timestamp:new Date().toISOString()});const E=await ue.sendEmailWithFallback(v,"booking_confirmation",{recipientEmail:o.email,recipientName:`${o.firstName} ${o.lastName}`.trim(),bookingData:{propertyName:F,checkIn:(a==null?void 0:a.from)||"",checkOut:(a==null?void 0:a.to)||"",guests:t||1,totalAmount:r!=null&&r.totalCents?r.totalCents/100:0,propertyId:s||""}});E.success?(console.log("‚úÖ Booking confirmation email sent successfully!",{bookingId:v,method:E.method}),H.trackEmailEvent({eventType:"email_sent",emailType:"booking_confirmation",bookingId:v,recipientEmail:o.email,provider:E.method,timestamp:new Date().toISOString()})):(console.error("‚ùå Failed to send booking confirmation email:",E.error),H.trackEmailEvent({eventType:"email_failed",emailType:"booking_confirmation",bookingId:v,recipientEmail:o.email,errorMessage:E.error,timestamp:new Date().toISOString()}))}catch(E){console.error("üí• Email service error:",E),console.log("üìß Email will be retried later or sent manually")}}catch(E){console.error("Failed to update booking status:",E)}const Se=r!=null&&r.totalCents?r.totalCents/100:0;d({bookingId:v,customerName:`${o.firstName} ${o.lastName}`.trim(),customerEmail:o.email,totalAmount:Se}),Ms(v,Se),p("confirmation")}catch(v){console.error("Error processing payment success:",v),I({payment:"Payment succeeded but there was an error processing your booking. Please contact support."})}},Je=c=>{console.error("Payment failed:",c),I({payment:c||"Payment failed. Please try again."})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Pe,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsxs("div",{className:"container py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(la,{currentStep:g})})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"lg:col-span-2",children:[g==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(ha,{form:o,errors:Z,onChange:S}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{type:"button",variant:"outline",onClick:()=>n(-1),className:"flex-1",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(b,{type:"button",onClick:Y,className:"flex-1",size:"lg",children:"Continue to Add-ons"})]})]}),g==="payment"&&f&&e.jsx(qs,{onRetry:()=>window.location.reload(),onGoBack:()=>p("details"),children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Cs,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Secure payment powered by Stripe"})]}),e.jsx(Is,{stripe:Rs,options:{clientSecret:f,appearance:Bs,locale:"en"},children:e.jsx(ca,{amount:r.totalCents,currency:r.currency,bookingId:A,bookingDetails:{unitName:F||"Property",checkIn:a.from,checkOut:a.to,guests:t,nights:r.nights},customerDetails:{name:`${o.firstName} ${o.lastName}`.trim(),email:o.email},onSuccess:ze,onError:Je})})]})}),g==="confirmation"&&u&&!q&&e.jsx(xa,{bookingId:u.bookingId,unitName:F||"Property",checkIn:a.from,checkOut:a.to,guests:t,customerName:u.customerName,customerEmail:u.customerEmail,totalAmount:u.totalAmount,currency:r.currency,onViewBooking:()=>{i(),n(`/view-booking/${u.bookingId}`)},onBackToHome:()=>{i(),n("/")}}),g==="confirmation"&&q&&e.jsx(Ws,{sepaPayment:q,bookingId:A,onCopyReference:c=>{console.log("Reference code copied:",c)},onDownloadInstructions:c=>{console.log("Downloading instructions for payment:",c)},onBackToHome:()=>{i(),n("/")}})]}),e.jsx("div",{className:"lg:col-span-1",children:g!=="confirmation"&&e.jsx(da,{unitName:F||"Property",checkIn:a.from,checkOut:a.to,guests:t,quote:r,className:"sticky top-8"})})]})]})]})};export{ja as default};
