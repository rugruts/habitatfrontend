var Ge=Object.defineProperty;var $e=(i,s,t)=>s in i?Ge(i,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[s]=t;var ie=(i,s,t)=>$e(i,typeof s!="symbol"?s+"":s,t);import{aq as Oe,s as z,r as l,ar as me,as as se,j as e,at as U,au as J,av as Le,aw as qe,ax as He,ay as xe,az as Ue,aA as Ve,aB as We,aC as Ke,c as D,aD as Ye,u as ze,R as ue,aE as H,m as Je,C as N,v as A,w as R,x as ae,i as v,aF as E,aj as pe,aG as te,aH as Xe,aI as Ze,aJ as Qe,aK as B,aL as es,aM as ss,aN as as,aO as ts,B as C,ak as oe,a3 as rs,K as re,an as X,aP as M,z as Z,y as Q,aQ as ce,aR as W,aS as O,O as q,P as he,aT as ns,aU as is,aV as os,aW as cs,aX as ls,aY as ds,aZ as ms,a_ as xs,a8 as us,H as ps,a$ as hs,b0 as gs,b1 as fs,t as ys,b2 as bs,S as le,A as de,b3 as js,b4 as Ns,b5 as vs,b6 as ks,b7 as ws,b8 as Cs,b9 as Ss,ba as Ps}from"./index-C9A5H9iZ.js";import{e as L,S as Es,K as As}from"./EmailAutomationService-6K_gtaI2.js";import{E as ee}from"./euro-Cewpc72q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=Oe("Apple",[["path",{d:"M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z",key:"3s7exb"}],["path",{d:"M10 2c1 .5 2 2 2 5",key:"fcco2y"}]]);class Is{constructor(){ie(this,"API_BASE_URL","https://backendhabitatapi.vercel.app/api")}createBookingConfirmationEmail(s){const t=new Date(s.checkIn).toLocaleDateString("en-GB"),r=new Date(s.checkOut).toLocaleDateString("en-GB"),a=Math.ceil((new Date(s.checkOut).getTime()-new Date(s.checkIn).getTime())/(1e3*60*60*24)),n=`Booking Confirmed - ${s.propertyName} | Habitat Lobby`,d=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Booking Confirmation</title>
        <style>
          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { background: #2D5A27; color: white; padding: 30px 20px; text-align: center; border-radius: 8px 8px 0 0; }
          .content { padding: 30px 20px; background: #ffffff; }
          .booking-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
          .detail-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 5px 0; border-bottom: 1px solid #eee; }
          .detail-row:last-child { border-bottom: none; }
          .footer { background: #f8f9fa; padding: 20px; text-align: center; font-size: 14px; color: #666; border-radius: 0 0 8px 8px; }
          .button { background: #D4A574; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 20px 0; }
          .highlight { background: #e8f5e8; padding: 15px; border-radius: 6px; margin: 15px 0; border-left: 4px solid #2D5A27; }
        </style>
      </head>
      <body>
        <div class="container">
          <div class="header">
            <h1>ðŸŽ‰ Booking Confirmed!</h1>
            <p>Thank you for choosing Habitat Lobby</p>
          </div>
          
          <div class="content">
            <p>Dear ${s.guestName},</p>
            
            <p>We're delighted to confirm your reservation. Your booking details are below:</p>
            
            <div class="booking-details">
              <h3 style="margin-top: 0; color: #2D5A27;">Booking Reference: ${s.bookingId}</h3>
              <div class="detail-row">
                <span><strong>Property:</strong></span>
                <span>${s.propertyName}</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-in:</strong></span>
                <span>${t} (15:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Check-out:</strong></span>
                <span>${r} (11:00)</span>
              </div>
              <div class="detail-row">
                <span><strong>Duration:</strong></span>
                <span>${a} night${a>1?"s":""}</span>
              </div>
              <div class="detail-row">
                <span><strong>Guests:</strong></span>
                <span>${s.guests}</span>
              </div>
              <div class="detail-row">
                <span><strong>Total Amount:</strong></span>
                <span><strong>â‚¬${s.totalAmount.toFixed(2)}</strong></span>
              </div>
            </div>
            
            ${s.specialRequests?`
            <div class="booking-details">
              <h4 style="margin-top: 0; color: #2D5A27;">Special Requests:</h4>
              <p style="margin-bottom: 0;">${s.specialRequests}</p>
            </div>
            `:""}
            
            <div class="highlight">
              <h3 style="margin-top: 0;">ðŸ“‹ What's Next?</h3>
              <ul style="margin-bottom: 0;">
                <li>You'll receive check-in instructions 48 hours before arrival</li>
                <li>Free cancellation up to 48 hours before check-in</li>
                <li>Our local team is available 24/7 for assistance</li>
                <li>Please bring the same ID document used during booking</li>
              </ul>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
              <a href="https://habitatlobby.com/view-booking/${s.bookingId}" class="button">
                View Booking Details
              </a>
            </div>
            
            <p>We look forward to hosting you in beautiful Trikala!</p>
            
            <p>Best regards,<br>
            <strong>The Habitat Lobby Team</strong></p>
          </div>
          
          <div class="footer">
            <p><strong>Habitat Lobby</strong> | Trikala, Greece</p>
            <p>For support, contact us at <a href="mailto:hello@habitatlobby.com">hello@habitatlobby.com</a></p>
            <p style="font-size: 12px; color: #999; margin-top: 15px;">
              This email was sent regarding your booking ${s.bookingId}. 
              Please keep this email for your records.
            </p>
          </div>
        </div>
      </body>
      </html>
    `,c=`
      Booking Confirmed - Habitat Lobby
      
      Dear ${s.guestName},
      
      We're delighted to confirm your reservation.
      
      Booking Reference: ${s.bookingId}
      Property: ${s.propertyName}
      Check-in: ${t} (15:00)
      Check-out: ${r} (11:00)
      Duration: ${a} night${a>1?"s":""}
      Guests: ${s.guests}
      Total Amount: â‚¬${s.totalAmount.toFixed(2)}
      
      ${s.specialRequests?`Special Requests: ${s.specialRequests}

`:""}
      
      What's Next?
      - You'll receive check-in instructions 48 hours before arrival
      - Free cancellation up to 48 hours before check-in
      - Our local team is available 24/7 for assistance
      - Please bring the same ID document used during booking
      
      View your booking: https://habitatlobby.com/view-booking/${s.bookingId}
      
      We look forward to hosting you in beautiful Trikala!
      
      Best regards,
      The Habitat Lobby Team
      
      Habitat Lobby | Trikala, Greece
      For support, contact us at hello@habitatlobby.com
    `;return{subject:n,html:d,text:c}}async sendBookingConfirmation(s){try{const t=this.createBookingConfirmationEmail(s);console.log("ðŸ“§ Sending booking confirmation email to:",s.guestEmail),console.log("ðŸ“§ Email subject:",t.subject);const r=await fetch(`${this.API_BASE_URL}/booking-confirmation`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":"habitat_lobby_2024_86abfb60f093d26335ebc1f3b028f254"},body:JSON.stringify({bookingId:s.bookingId})});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(`Email API error: ${r.status} - ${n.error||"Unknown error"}`)}const a=await r.json();return console.log("âœ… Email sent successfully via API:",a),console.log("âœ… Booking confirmation email sent successfully"),!0}catch(t){return console.error("âŒ Failed to send booking confirmation email:",t),!1}}async sendBookingConfirmationById(s){var t;try{const r=await z.getAllBookings(1,0,{booking_id:s});if(!r.bookings||r.bookings.length===0)return console.error("Booking not found:",s),!1;const a=r.bookings[0],n={bookingId:a.id,guestName:a.customer_name,guestEmail:a.customer_email,propertyName:((t=a.properties)==null?void 0:t.name)||"Property",checkIn:a.check_in,checkOut:a.check_out,guests:a.guests,totalAmount:a.total_amount,currency:a.currency||"EUR",specialRequests:a.special_requests};return await this.sendBookingConfirmation(n)}catch(r){return console.error("Failed to send booking confirmation by ID:",r),!1}}}const K=new Is,_s=()=>{const i=l.useCallback(async a=>{try{const n={...a,booking_status:"confirmed"};await L.processAutomationTrigger(n),console.log("âœ… Booking confirmation email triggered")}catch(n){console.error("âŒ Error triggering booking confirmation email:",n)}},[]),s=l.useCallback(async a=>{try{const n={...a,booking_status:"confirmed"};await L.processAutomationTrigger(n),console.log("âœ… Pre-arrival email scheduled")}catch(n){console.error("âŒ Error scheduling pre-arrival email:",n)}},[]),t=l.useCallback(async a=>{try{const n={...a,booking_status:"completed"};await L.processAutomationTrigger(n),console.log("âœ… Post-checkout review email scheduled")}catch(n){console.error("âŒ Error scheduling post-checkout review email:",n)}},[]),r=l.useCallback(async(a,n)=>{try{await L.processAutomationTrigger(n),console.log(`âœ… Manual email triggered: ${a}`)}catch(d){console.error(`âŒ Error triggering manual email (${a}):`,d)}},[]);return{triggerBookingConfirmation:i,triggerPreArrivalEmail:s,triggerPostCheckoutReview:t,triggerManualEmail:r}};var ne="Radio",[Bs,ge]=me(ne),[Ds,Ms]=Bs(ne),fe=l.forwardRef((i,s)=>{const{__scopeRadio:t,name:r,checked:a=!1,required:n,disabled:d,value:c="on",onCheck:u,form:h,...f}=i,[o,g]=l.useState(null),x=se(s,k=>g(k)),y=l.useRef(!1),b=o?h||!!o.closest("form"):!0;return e.jsxs(Ds,{scope:t,checked:a,disabled:d,children:[e.jsx(U.button,{type:"button",role:"radio","aria-checked":a,"data-state":Ne(a),"data-disabled":d?"":void 0,disabled:d,value:c,...f,ref:x,onClick:J(i.onClick,k=>{a||u==null||u(),b&&(y.current=k.isPropagationStopped(),y.current||k.stopPropagation())})}),b&&e.jsx(je,{control:o,bubbles:!y.current,name:r,value:c,checked:a,required:n,disabled:d,form:h,style:{transform:"translateX(-100%)"}})]})});fe.displayName=ne;var ye="RadioIndicator",be=l.forwardRef((i,s)=>{const{__scopeRadio:t,forceMount:r,...a}=i,n=Ms(ye,t);return e.jsx(Le,{present:r||n.checked,children:e.jsx(U.span,{"data-state":Ne(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:s})})});be.displayName=ye;var Fs="RadioBubbleInput",je=l.forwardRef(({__scopeRadio:i,control:s,checked:t,bubbles:r=!0,...a},n)=>{const d=l.useRef(null),c=se(d,n),u=qe(t),h=He(s);return l.useEffect(()=>{const f=d.current;if(!f)return;const o=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(o,"checked").set;if(u!==t&&x){const y=new Event("click",{bubbles:r});x.call(f,t),f.dispatchEvent(y)}},[u,t,r]),e.jsx(U.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...a,tabIndex:-1,ref:c,style:{...a.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});je.displayName=Fs;function Ne(i){return i?"checked":"unchecked"}var Ts=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],V="RadioGroup",[Gs,ea]=me(V,[xe,ge]),ve=xe(),ke=ge(),[$s,Os]=Gs(V),we=l.forwardRef((i,s)=>{const{__scopeRadioGroup:t,name:r,defaultValue:a,value:n,required:d=!1,disabled:c=!1,orientation:u,dir:h,loop:f=!0,onValueChange:o,...g}=i,x=ve(t),y=Ue(h),[b,k]=Ve({prop:n,defaultProp:a??null,onChange:o,caller:V});return e.jsx($s,{scope:t,name:r,required:d,disabled:c,value:b,onValueChange:k,children:e.jsx(We,{asChild:!0,...x,orientation:u,dir:y,loop:f,children:e.jsx(U.div,{role:"radiogroup","aria-required":d,"aria-orientation":u,"data-disabled":c?"":void 0,dir:y,...g,ref:s})})})});we.displayName=V;var Ce="RadioGroupItem",Se=l.forwardRef((i,s)=>{const{__scopeRadioGroup:t,disabled:r,...a}=i,n=Os(Ce,t),d=n.disabled||r,c=ve(t),u=ke(t),h=l.useRef(null),f=se(s,h),o=n.value===a.value,g=l.useRef(!1);return l.useEffect(()=>{const x=b=>{Ts.includes(b.key)&&(g.current=!0)},y=()=>g.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",y),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",y)}},[]),e.jsx(Ke,{asChild:!0,...c,focusable:!d,active:o,children:e.jsx(fe,{disabled:d,required:n.required,checked:o,...u,...a,name:n.name,ref:f,onCheck:()=>n.onValueChange(a.value),onKeyDown:J(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:J(a.onFocus,()=>{var x;g.current&&((x=h.current)==null||x.click())})})})});Se.displayName=Ce;var Ls="RadioGroupIndicator",Pe=l.forwardRef((i,s)=>{const{__scopeRadioGroup:t,...r}=i,a=ke(t);return e.jsx(be,{...a,...r,ref:s})});Pe.displayName=Ls;var Ee=we,Ae=Se,qs=Pe;const Re=l.forwardRef(({className:i,...s},t)=>e.jsx(Ee,{className:D("grid gap-2",i),...s,ref:t}));Re.displayName=Ee.displayName;const Ie=l.forwardRef(({className:i,...s},t)=>e.jsx(Ae,{ref:t,className:D("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),...s,children:e.jsx(qs,{className:"flex items-center justify-center",children:e.jsx(Ye,{className:"h-2.5 w-2.5 fill-current text-current"})})}));Ie.displayName=Ae.displayName;const Hs=({selectedMethod:i,onMethodChange:s,amount:t,currency:r,className:a})=>{const{t:n}=ze(),[d,c]=l.useState(!1),[u,h]=l.useState(!1);ue.useEffect(()=>{window.ApplePaySession&&ApplePaySession.canMakePayments()&&c(!0),window.google&&window.google.payments&&h(!0)},[]);const f=[{id:"card",name:n("payment.creditCard"),description:n("payment.creditCardDesc"),icon:H,available:!0,badge:null},{id:"apple_pay",name:"Apple Pay",description:n("payment.applePayDesc"),icon:Rs,available:d,badge:d?null:n("payment.notAvailable")},{id:"google_pay",name:"Google Pay",description:n("payment.googlePayDesc"),icon:Es,available:u,badge:u?null:n("payment.notAvailable")},{id:"sepa",name:"SEPA Direct Debit",description:n("payment.sepaDesc"),icon:Je,available:!0,badge:null},{id:"cash_on_arrival",name:n("payment.cashOnArrival"),description:n("payment.cashOnArrivalDesc"),icon:ee,available:!0,badge:n("payment.arrivalOnly")}];return e.jsxs(N,{className:a,children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-green-600"}),n("payment.selectMethod")]})}),e.jsxs(v,{children:[e.jsx(Re,{value:i,onValueChange:o=>s(o),children:e.jsx("div",{className:"space-y-3",children:f.map(o=>{const g=o.icon;return e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{value:o.id,id:o.id,className:"peer sr-only",disabled:!o.available}),e.jsx(E,{htmlFor:o.id,className:`flex items-center gap-3 p-4 border rounded-lg cursor-pointer transition-all duration-200 ${i===o.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"} ${o.available?"":"opacity-50 cursor-not-allowed"}`,children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(g,{className:"h-6 w-6 text-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:o.name}),o.badge&&e.jsx(pe,{variant:"secondary",className:"text-xs",children:o.badge}),i===o.id&&e.jsx(te,{className:"h-4 w-4 text-green-600"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:o.description})]})]})})]},o.id)})})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{className:"font-medium text-gray-800 mb-1",children:n("payment.securityTitle")}),e.jsx("p",{children:n("payment.securityDesc")})]})]})}),e.jsx("div",{className:"mt-4 p-4 bg-primary/5 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[n("payment.totalAmount"),":"]}),e.jsx("span",{className:"text-xl font-bold text-primary",children:new Intl.NumberFormat("el-GR",{style:"currency",currency:r}).format(t/100)})]})})]})]})},Us=({amount:i,currency:s,bookingId:t,bookingDetails:r,customerDetails:a,onSuccess:n,onError:d})=>{const c=Ze(),u=Qe(),[h,f]=l.useState(!1),[o,g]=l.useState(""),[x,y]=l.useState("card");l.useState(!1);const b=async S=>{S.preventDefault(),f(!0),g("");try{if(x==="cash_on_arrival"){await k();return}if(!c||!u)throw new Error("Stripe not available");const{error:P,paymentIntent:I}=await c.confirmPayment({elements:u,confirmParams:{return_url:`${window.location.origin}/booking-confirmation`,payment_method_data:{billing_details:{name:(a==null?void 0:a.name)||"Guest",email:(a==null?void 0:a.email)||void 0}}},redirect:"if_required"});P?(g(P.message||"An unexpected error occurred."),d(P.message||"Payment failed")):I&&I.status==="succeeded"&&n(I)}catch(P){console.error("Payment error:",P),g("An unexpected error occurred during payment."),d("Payment failed")}finally{f(!1)}},k=async()=>{try{const S={id:`cash_${Date.now()}`,status:"succeeded",amount:i,metadata:{payment_method:"cash_on_arrival",booking_id:t}};n(S)}catch(S){console.error("Cash on arrival error:",S),g("Failed to process cash on arrival booking."),d("Cash on arrival booking failed")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{className:"border-0 shadow-lg bg-gray-50",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-green-600"}),"Booking Summary"]})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Accommodation:"}),e.jsx("span",{className:"text-sm font-medium",children:r.unitName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-in:"}),e.jsx("span",{className:"text-sm font-medium",children:r.checkIn})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Check-out:"}),e.jsx("span",{className:"text-sm font-medium",children:r.checkOut})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Guests:"}),e.jsx("span",{className:"text-sm font-medium",children:r.guests})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nights:"}),e.jsx("span",{className:"text-sm font-medium",children:r.nights})]}),e.jsx("div",{className:"border-t pt-3 mt-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-semibold",children:"Total Amount:"}),e.jsx("span",{className:"font-bold text-lg",children:B(i,s)})]})})]})]}),e.jsx(Hs,{selectedMethod:x,onMethodChange:y,amount:i,currency:s}),e.jsxs(N,{className:"border-0 shadow-lg",children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-accent"}),"Payment Details"]})}),e.jsxs(v,{children:[x==="cash_on_arrival"&&e.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-blue-900 mb-2",children:"Cash on Arrival"}),e.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"You can pay in cash when you arrive at the property. No payment is required now."}),e.jsxs("div",{className:"text-sm text-blue-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amount to pay:"})," ",B(i,s)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment location:"})," At the property upon check-in"]})]})]})]})}),x!=="cash_on_arrival"&&e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Billing Address"}),e.jsx(es,{options:{mode:"billing",allowedCountries:["GR","US","GB","DE","FR","IT","ES"]}})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Payment Method"}),e.jsx(ss,{options:{layout:"tabs",wallets:{applePay:"auto",googlePay:"auto"}}})]}),o&&e.jsx(as,{variant:"destructive",children:e.jsx(ts,{children:o})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-blue-50 p-3 rounded-lg",children:[e.jsx(ae,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{children:"Your payment information is secure and encrypted"})]}),e.jsx(C,{type:"submit",disabled:!c||h,className:"w-full h-12 text-lg font-semibold bg-accent hover:bg-accent/90",children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 animate-spin"}),"Processing Payment..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Pay ",B(i,s)]})})]}),x==="cash_on_arrival"&&e.jsx(C,{onClick:b,disabled:h,className:"w-full h-12 text-lg font-semibold bg-green-600 hover:bg-green-700",children:h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 animate-spin"}),"Processing Booking..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Confirm Cash on Arrival Booking"]})})]})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"We accept multiple payment methods for your convenience"}),e.jsxs("div",{className:"flex justify-center gap-3 mt-3 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ’³"}),e.jsx("span",{className:"text-xs",children:"Cards"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸŽ"}),e.jsx("span",{className:"text-xs",children:"Apple Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸŸ¢"}),e.jsx("span",{className:"text-xs",children:"Google Pay"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ…¿ï¸"}),e.jsx("span",{className:"text-xs",children:"PayPal"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-3 py-1 rounded-full",children:[e.jsx("span",{children:"ðŸ¦"}),e.jsx("span",{className:"text-xs",children:"Bank Transfer"})]})]}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"Secure payments powered by Stripe"})]})]})},Y=[{id:"details",label:"Guest Details",description:"Your information & ID verification"},{id:"payment",label:"Payment",description:"Secure checkout"},{id:"confirmation",label:"Confirmation",description:"Booking complete"}],Vs=({currentStep:i})=>{const s=Y.findIndex(t=>t.id===i);return e.jsx("div",{className:"w-full py-6",children:e.jsx("div",{className:"flex items-center justify-between",children:Y.map((t,r)=>{const a=r<s,n=r===s,d=r>s;return e.jsxs(ue.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:D("w-10 h-10 rounded-full flex items-center justify-center text-sm font-semibold transition-all duration-300",a&&"bg-green-600 text-white",n&&"bg-accent text-white ring-4 ring-accent/20",d&&"bg-gray-200 text-gray-500"),children:a?e.jsx(rs,{className:"w-5 h-5"}):e.jsx("span",{children:r+1})}),e.jsxs("div",{className:"mt-2 text-center",children:[e.jsx("div",{className:D("text-sm font-medium",a&&"text-green-600",n&&"text-accent",d&&"text-gray-500"),children:t.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.description})]})]}),r<Y.length-1&&e.jsx("div",{className:D("flex-1 h-0.5 mx-4 transition-all duration-300",r<s?"bg-green-600":"bg-gray-200")})]},t.id)})})})},Ws=({unitName:i,checkIn:s,checkOut:t,guests:r,quote:a,className:n})=>{const d=new Date(s),c=new Date(t);return e.jsxs(N,{className:n,children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-accent"}),"Booking Summary"]})}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:i}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("span",{children:[M(d,"EEE, MMM d")," - ",M(c,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.nights," nights"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs("span",{children:[r," guest",r!==1?"s":""]})]})]})]}),e.jsx(ce,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Price Details"}),a.lineItems.map((u,h)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:u.label}),e.jsx("span",{className:"font-medium",children:B(u.amountCents,a.currency)})]},h)),e.jsx(ce,{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"text-accent",children:B(a.totalCents,a.currency)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs("span",{children:["Free cancellation until ",a.refundableUntil?M(new Date(a.refundableUntil),"MMM d, h:mm a"):"48 hours before check-in"]})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h5",{className:"font-medium text-sm mb-1",children:"Check-in Information"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["Check-in: 3:00 PM - 10:00 PM",e.jsx("br",{}),"Check-out: 11:00 AM",e.jsx("br",{}),"Self check-in with keypad"]})]})]})]})]})},Ks=[{code:"GR",name:"Greece"},{code:"US",name:"United States"},{code:"GB",name:"United Kingdom"},{code:"DE",name:"Germany"},{code:"FR",name:"France"},{code:"IT",name:"Italy"},{code:"ES",name:"Spain"},{code:"NL",name:"Netherlands"},{code:"BE",name:"Belgium"},{code:"AT",name:"Austria"},{code:"CH",name:"Switzerland"},{code:"SE",name:"Sweden"},{code:"NO",name:"Norway"},{code:"DK",name:"Denmark"},{code:"FI",name:"Finland"},{code:"CA",name:"Canada"},{code:"AU",name:"Australia"},{code:"JP",name:"Japan"},{code:"OTHER",name:"Other"}],Ys=({form:i,errors:s,onChange:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(A,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-accent"}),"Contact Information"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your contact details for booking confirmation and communication."})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"firstName",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"First Name *"]}),e.jsx(O,{id:"firstName",value:i.firstName,onChange:r=>t("firstName",r.target.value),className:s.firstName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your first name",required:!0}),s.firstName&&e.jsx("p",{className:"text-sm text-red-600",children:s.firstName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"lastName",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Last Name *"]}),e.jsx(O,{id:"lastName",value:i.lastName,onChange:r=>t("lastName",r.target.value),className:s.lastName?"border-red-500 focus:border-red-500":"",placeholder:"Enter your last name",required:!0}),s.lastName&&e.jsx("p",{className:"text-sm text-red-600",children:s.lastName})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),"Email Address *"]}),e.jsx(O,{id:"email",type:"email",value:i.email,onChange:r=>t("email",r.target.value),className:s.email?"border-red-500 focus:border-red-500":"",placeholder:"your.email@example.com",required:!0}),s.email&&e.jsx("p",{className:"text-sm text-red-600",children:s.email}),e.jsx("p",{className:"text-xs text-gray-500",children:"We'll send your booking confirmation and check-in instructions to this email."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Phone Number"]}),e.jsx(O,{id:"phone",type:"tel",value:i.phone,onChange:r=>t("phone",r.target.value),className:s.phone?"border-red-500 focus:border-red-500":"",placeholder:"+30 123 456 7890"}),s.phone&&e.jsx("p",{className:"text-sm text-red-600",children:s.phone}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We may contact you if needed regarding your stay."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"country",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Country of Residence"]}),e.jsxs(ns,{value:i.country,onValueChange:r=>t("country",r),children:[e.jsx(is,{className:s.country?"border-red-500 focus:border-red-500":"",children:e.jsx(os,{placeholder:"Select your country"})}),e.jsx(cs,{children:Ks.map(r=>e.jsx(ls,{value:r.code,children:r.name},r.code))})]}),s.country&&e.jsx("p",{className:"text-sm text-red-600",children:s.country})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(E,{htmlFor:"specialRequests",className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"Special Requests"]}),e.jsx(ms,{id:"specialRequests",value:i.specialRequests,onChange:r=>t("specialRequests",r.target.value),placeholder:"Any special requests or requirements for your stay? (e.g., early check-in, late check-out, accessibility needs)",rows:3,className:"resize-none"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Optional. We'll do our best to accommodate your requests."})]})]})]}),e.jsx(N,{className:"bg-blue-50 border-blue-200",children:e.jsx(v,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Check-in Information"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Please bring a valid ID (passport or national ID card) for verification during check-in. The primary guest must be at least 18 years old."})]})]})})})]}),zs=({bookingId:i,unitName:s,checkIn:t,checkOut:r,guests:a,customerName:n,customerEmail:d,totalAmount:c,currency:u,onBackToHome:h,onViewBooking:f,onDownloadConfirmation:o})=>{const g=new Date(t),x=new Date(r),y=Math.ceil((x.getTime()-g.getTime())/(1e3*60*60*24));return e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{className:"border-green-200 bg-green-50",children:e.jsxs(v,{className:"p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-green-600 rounded-full flex items-center justify-center",children:e.jsx(te,{className:"w-8 h-8 text-white"})})}),e.jsx("h1",{className:"text-2xl font-bold text-green-800 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-green-700 mb-4",children:"Thank you for choosing Habitat Lobby. Your reservation has been successfully created."}),e.jsxs(pe,{variant:"secondary",className:"bg-green-100 text-green-800 px-4 py-2",children:["Booking ID: ",i.slice(-8).toUpperCase()]})]})}),e.jsxs(N,{children:[e.jsx(A,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-accent"}),"Booking Details"]})}),e.jsx(v,{className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:s}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Trikala, Greece"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs("span",{children:[M(g,"EEE, MMM d")," - ",M(x,"EEE, MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[y," night",y!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs("span",{children:[a," guest",a!==1?"s":""]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Guest Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:n})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:d})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Total Amount"}),e.jsx("div",{className:"text-2xl font-bold text-accent",children:B(c*100,u)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Payment confirmed"})]})]})]})})]}),e.jsxs(N,{children:[e.jsx(A,{children:e.jsx(R,{children:"What's Next?"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(q,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Confirmation Email Sent"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["A detailed confirmation has been sent to ",d]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Z,{className:"w-4 h-4 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Check-in Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Detailed check-in instructions will be sent 24 hours before your arrival"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(As,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Access Codes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Door codes and WiFi details will be provided 2 hours before check-in"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"24/7 Support"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Our team is available around the clock during your stay"})]})]})]})})]}),e.jsx(N,{className:"bg-gray-50",children:e.jsxs(v,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Need Help?"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Contact Information"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"hello@habitatlobby.com"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"+30 243 123 4567"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Check-in Details"}),e.jsxs("div",{className:"space-y-1 text-gray-600",children:[e.jsx("p",{children:"Check-in: 3:00 PM - 10:00 PM"}),e.jsx("p",{children:"Check-out: 11:00 AM"}),e.jsx("p",{children:"Self check-in available"})]})]})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(C,{onClick:f,className:"flex-1",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"View & Manage Booking"]}),e.jsxs(C,{onClick:h,variant:"outline",className:"flex-1",children:[e.jsx(ps,{className:"h-4 w-4 mr-2"}),"Back to Home"]}),o&&e.jsxs(C,{onClick:o,variant:"outline",className:"flex-1",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Download Confirmation"]})]})]})},sa=()=>{const i=gs(),{unitSlug:s,dates:t,guests:r,quote:a,reset:n}=fs(),{triggerBookingConfirmation:d}=_s(),[c,u]=l.useState({firstName:"",lastName:"",email:"",phone:"",country:"",specialRequests:""}),[h,f]=l.useState(!1),[o,g]=l.useState(null),[x,y]=l.useState("details"),[b,k]=l.useState(""),[S,P]=l.useState(""),[I,_]=l.useState({}),[F,T]=l.useState("");l.useEffect(()=>{console.log("ðŸ§ª CheckoutEnhanced: bookingEmailService loaded:",!!K),console.log("ðŸ§ª CheckoutEnhanced: bookingEmailService type:",typeof K),ys("checkout"),s&&bs(s)},[s]),l.useEffect(()=>{(async()=>{if(s){console.log("Fetching property name for unitSlug:",s);try{const j=ws.find(G=>G.slug===s);if(j){console.log("Found apartment by slug:",j.name),T(j.name);return}console.log("Not found in apartments data, fetching from Supabase...");const p=await z.getProperty(s);p?(console.log("Found property in Supabase:",p.name),T(p.name)):(console.log("Property not found, using fallback"),T(s))}catch(j){console.error("Error fetching property name:",j),T(s)}}})()},[s]);const _e=(m,j)=>{u(p=>({...p,[m]:j})),I[m]&&_(p=>({...p,[m]:""}))},Be=l.useCallback(()=>{const m={};return c.firstName.trim()||(m.firstName="First name is required"),c.lastName.trim()||(m.lastName="Last name is required"),c.email.trim()?/\S+@\S+\.\S+/.test(c.email)||(m.email="Please enter a valid email address"):m.email="Email is required",_(m),Object.keys(m).length===0},[c]);if(!s||!a||!t.from||!t.to)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(le,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsx("div",{className:"container py-10",children:e.jsx(N,{className:"max-w-md mx-auto",children:e.jsxs(v,{className:"p-6 text-center",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"No booking in progress."}),e.jsxs(C,{onClick:()=>i(-1),variant:"outline",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Go Back"]})]})})})]});const De=async m=>{m.preventDefault(),Be()&&await Me()},Me=async()=>{f(!0),_({});try{console.log("Starting checkout process...");const m=await Cs.startCheckout({unitSlug:s,checkIn:t.from,checkOut:t.to,guests:r,customer:c});if(console.log("Checkout response:",m),!m.clientSecret)throw new Error("No client secret received from payment service");k(m.clientSecret),P(m.bookingId),y("payment")}catch(m){console.error("Failed to create payment intent:",m);const j=m instanceof Error?m.message:"Failed to prepare payment. Please try again.";_({payment:j})}finally{f(!1)}},Fe=async m=>{var j;try{console.log("Payment success! Payment intent:",m),console.log("Payment intent metadata:",m.metadata);let p=(j=m.metadata)==null?void 0:j.booking_id;if(!p){console.log("No booking_id in metadata, searching by payment_intent_id:",m.id);try{const{data:w,error:$}=await Ss.from("bookings").select("id").eq("payment_intent_id",m.id).single();if($)throw console.error("Error finding booking by payment_intent_id:",$),new Error("Could not find booking for this payment");p=w.id,console.log("Found booking by payment_intent_id:",p)}catch(w){throw console.error("Database error:",w),new Error("Could not find booking for this payment")}}if(!p)throw console.error("No booking_id found. Available metadata keys:",Object.keys(m.metadata||{})),new Error("No booking ID found in payment intent");if(p)try{await z.updateBookingStatus(p,"confirmed"),console.log("âœ… Booking confirmed:",p),console.log("ðŸ”„ Starting email notification process...");try{console.log("ðŸ”„ Attempting to send booking confirmation email for booking:",p),console.log("ðŸ“§ Calling bookingEmailService.sendBookingConfirmationById...");const w=await K.sendBookingConfirmationById(p);console.log("ðŸ“§ Email service result:",w),w?console.log("âœ… Booking confirmation email sent successfully!",{bookingId:p}):(console.error("âŒ Failed to send booking confirmation email"),console.log("ðŸ“§ Email will be retried later or sent manually"));try{console.log("ðŸ”„ Triggering email automation for booking confirmation..."),await d({booking_id:p,guest_email:c.email,guest_name:`${c.firstName} ${c.lastName}`.trim(),property_name:F,check_in:(t==null?void 0:t.checkIn)||"",check_out:(t==null?void 0:t.checkOut)||"",guest_count:r||1,total_amount:a!=null&&a.totalCents?a.totalCents/100:0,property_id:s||""}),console.log("âœ… Email automation triggered successfully")}catch($){console.error("âŒ Error triggering email automation:",$)}}catch(w){console.error("ðŸ’¥ Email service error:",w),console.log("ðŸ“§ Email will be retried later or sent manually")}}catch(w){console.error("Failed to update booking status:",w)}const G=a!=null&&a.totalCents?a.totalCents/100:0;g({bookingId:p,customerName:`${c.firstName} ${c.lastName}`.trim(),customerEmail:c.email,totalAmount:G}),Ps(p,G),y("confirmation")}catch(p){console.error("Error processing payment success:",p),_({payment:"Payment succeeded but there was an error processing your booking. Please contact support."})}},Te=m=>{console.error("Payment failed:",m),_({payment:m||"Payment failed. Please try again."})};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(le,{title:"Checkout - Habitat Lobby",description:"Complete your booking at Habitat Lobby",noindex:!0}),e.jsxs("div",{className:"container py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsx(Vs,{currentStep:x})})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"lg:col-span-2",children:[x==="details"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ys,{form:c,errors:I,onChange:_e}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(C,{type:"button",variant:"outline",onClick:()=>i(-1),className:"flex-1",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx(C,{type:"button",onClick:De,className:"flex-1",size:"lg",children:"Continue to Add-ons"})]})]}),x==="payment"&&b&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(js,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Secure payment powered by Stripe"})]}),e.jsx(Ns,{stripe:vs,options:{clientSecret:b,appearance:ks,locale:"en"},children:e.jsx(Us,{amount:a.totalCents,currency:a.currency,bookingId:S,bookingDetails:{unitName:F||"Property",checkIn:t.from,checkOut:t.to,guests:r,nights:a.nights},customerDetails:{name:`${c.firstName} ${c.lastName}`.trim(),email:c.email},onSuccess:Fe,onError:Te})})]}),x==="confirmation"&&o&&e.jsx(zs,{bookingId:o.bookingId,unitName:F||"Property",checkIn:t.from,checkOut:t.to,guests:r,customerName:o.customerName,customerEmail:o.customerEmail,totalAmount:o.totalAmount,currency:a.currency,onViewBooking:()=>{n(),i(`/view-booking/${o.bookingId}`)},onBackToHome:()=>{n(),i("/")}})]}),e.jsx("div",{className:"lg:col-span-1",children:x!=="confirmation"&&e.jsx(Ws,{unitName:F||"Property",checkIn:t.from,checkOut:t.to,guests:r,quote:a,className:"sticky top-8"})})]})]})]})};export{sa as default};
